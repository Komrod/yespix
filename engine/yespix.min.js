!function(undefined){function yespix(a){return this instanceof yespix?(this.init(a),void this.trigger("ready")):new yespix(a)}function initEntities(a){a.define("base",{_yespix:a,_class:"",_ancestors:[],_scene:null,_id:1,_children:null,_parent:null,isActive:!0,isVisible:!1,isGlobal:!1,name:"",assets:function(){return[]},init:function(){return!0},ancestor:function(b){return a.inArray(this._ancestors,b)},"typeof":function(b){if(a.isArray(b)){for(var c=0;c<b.length;c++)if(this.typeOf(b[c]))return!0;return!1}return this.ancestor(b)||this._class==b},prop:function(b,c){if(a.isObject(b)){for(var d in b)this[d]=b[d];return this}return this[b]=c,this},clone:function(b){var c=a.clone(this);return c._id=a.entityNextId++,b&&c.prop(b),c._instances=null,a.dump(a.entityInstances),a.instanceAdd(c),a.dump(a.entityInstances),c},attach:function(b){return a.attach(this,b),this},detach:function(b){return a.detach(this,b),this},trigger:function(b,c){return a.trigger(b,c,this),this},on:function(b,c){return a.on(b,c,this),this},off:function(b,c){return a.off(b,c,this),this},listen:function(b,c){return a.listen(this,b,c)},destroy:function(){if(this._deleting=!0,this.isActive=!1,this.isVisible=!1,this._children)for(var b=0;b<this._children.length;b++)this._children[b]&&!this._children[b].deleting&&this._children[b].destroy();return a.instanceRemove(this),this}}),a.entityRootClassname="base",a.define("gfx",{_changed:!1,isReady:!1,isVisible:!0,snapToPixel:!1,x:0,y:0,z:0,zGlobal:0,alpha:1,rotation:0,_flipX:!1,_flipY:!1,asset:function(){return[]},init:function(){return a.listen(this,["z","zGlobal"],function(){a.drawEntitiesSort=!0}),!0},getDrawBox:function(){if(this.snapToPixel)var a=parseInt(this.x),b=parseInt(this.y);else var a=this.x,b=this.y;var c=this.width,d=this.height;if(this.typeof("image")){var e=this.image(this.imageSelected);c=this.width||e.width||e.realWidth,d=this.height||e.height||e.realHeight}else if(this.typeof("anim")){var e=this.image(this.imageSelected);c=this.width||e.width||e.realWidth,d=this.height||e.height||e.realHeight}return{x:a,y:b,width:c,height:d}},getContext:function(){if(this._context)return this._context;if(null==this._parent){var b=a.find(".canvas")[0];!this._context&&b&&(this._context=b.context)}return this._context}}),a.define("sound",{sounds:[],soundDefaults:{isInitiated:!1,isSupported:!1,isReady:!1,volume:1,duration:0,formats:[],src:"",mimeType:"",loop:!1,autoplay:!1,element:null,document:a.document,assets:this.assets},init:function(){var b=1;a.isString(this.sounds)&&(this.sounds=[{src:this.sounds}]);for(var c=0;c<this.sounds.length;c++){for(var d in this.soundDefaults)this.sounds[c][d]=this.sounds[c][d]||this.soundDefaults[d];""===this.sounds[c].name&&(this.sounds[c].name="sound"+b++)}this.sound=function(a){var b="";if(a==undefined)return this.sounds[0]?this.soundInit(this.sounds[0]):null;if("string"==typeof a){if(a={name:a},-1!=a.name.indexOf("/")){var c=a.name.split("/");if(a.name=c[0],b=c[1],""==c[0])return this.soundInit(this.sounds[0])[b]()}}else if(Object.isInt(a))return this.sounds[a]?this.soundInit(this.sounds[a]):null;for(var d=Object.keys(a).length,e=0,f=0;f<this.sounds.length;f++)for(var g in a){if(this.sounds[f][g]!==undefined&&a[g]==this.sounds[f][g]&&e++,""!=b)return this.soundInit(this.sounds[f])[b]();if(e>=d)return this.soundInit(this.sounds[f])}return null},this.soundInit=function(b){if(parent=this,b==undefined){for(var c=0;c<this.sounds.length;c++)this.soundInit(this.sounds[c]);return!0}if(b.isInitiated)return b;if(b.isInitiated=!0,b.element=document.createElement("audio"),b.support=function(b){return b==undefined?!1:a.support(b)},b.changeSource=function(b){return this.support("."+a.getExtension(b))?(this.isSupported=!0,this.element.src=b,this.volume<0?this.volume=0:this.volume>1&&(this.volume=1),this.element.volume=this.volume,!0):!1},b.load=function(){return this.isSupported?(this.element.load(),this):this},b.play=function(){return this.isSupported?(this.element.play(),this):this},b.isPlaying=function(){return this.isSupported?!this.element.paused:null},b.pause=function(){return this.isSupported?(this.element.pause(),this):this},b.isPaused=function(){return this.isSupported?!!this.element.paused:null},b.mute=function(){return this.isSupported?(this.element.muted=!0,this):null},b.unmute=function(){return this.isSupported?(this.element.muted=!1,this):this},b.muteToggle=function(){return this.isSupported?(this.isMuted()?this.unmute():this.mute(),this):this},b.isMuted=function(){return this.isSupported?this.element.muted:null},b.restart=function(){return this.isSupported?(this.stop().play(),this):this},b.stop=function(){return this.isSupported?(this.element.pause(),this.setTime(0),this):this},b.setVolume=function(a){return this.isSupported?(this.volume=a,this.volume<0?this.volume=0:this.volume>1&&(this.volume=1),this.element.volume=this.volume,this):this},b.volumeUp=function(){return this.isSupported?(this.volume-=.1,this.volume<0?this.volume=0:this.volume>1&&(this.volume=1),this.element.volume=this.volume,this):this},b.volumeDown=function(){return this.isSupported?(this.volume+=.1,this.volume<0?this.volume=0:this.volume>1&&(this.volume=1),this.element.volume=this.volume,this):this},b.setTime=function(a){return this.isSupported?(this.element.currentTime=a,this):this},b.isEnded=function(){return this.isSupported?this.element.ended:null},b.src!==undefined&&""!==b.src)if(a.isArray(b.src))for(var c=0;c<b.src.length;c++)b.src[c]&&!b.isSupported&&b.changeSource(b.src[c]);else if(a.isArray(b.formats)&&b.formats.length>0)for(var c=0;c<b.formats.length;c++)b.formats[c]&&!b.isSupported&&b.changeSource(b.src+"."+b.formats[c]);else a.isString(b.src)&&""!=b.src&&b.changeSource(b.src);return b},this.assets=function(b){if(parent=this,b==undefined){for(var c=[],d=0;d<this.sounds.length;d++)c=c.concat(this.assets(this.sounds[d]));return c}if(b.src!==undefined&&""!==b.src){if(a.isArray(b.src)){for(var d=0;d<b.src.length;d++)if(b.src[d]&&a.support("."+a.getExtension(b.src[d])))return b.src=b.src[d],b.isSupported=!0,[b.src];return[]}if(a.isArray(b.formats)&&b.formats.length>0){for(var d=0;d<b.formats.length;d++)if(b.formats[d]&&a.support("."+b.formats[d]))return b.src=b.src+"."+b.formats[d],b.isSupported=!0,[b.src]}else{if(a.isString(b.src)&&-1!=b.src.indexOf("|")){for(var e=b.src.split("|"),d=0;d<e.length;d++)if(e[d]&&a.support("."+a.getExtension(e[d])))return b.src=e[d],b.isSupported=!0,[b.src];return[]}if(a.isString(b.src)&&""!=b.src&&a.support("."+a.getExtension(b.src)))return b.isSupported=!0,[b.src]}}return[]}}}),a.define("canvas",{canvasOptions:null,element:null,context:null,document:null,init:function(a){this.create(a)},create:function(b){b=b||{},b.document=b.document||a.document,b.width=b.width||800,b.height=b.height||600,b.style=b.style||{},b.id=b.id||"canvas"+this._id,b.class=b.class||"",b.autoAppend=b.autoAppend||!0,this.canvasOptions=b,this.document=b.document;var c=this.document.createElement("canvas");c.id=b.id,c.width=b.width,c.height=b.height,c.className=b.className;for(var d in b.style)c.style[d]=b.style[d];if(b.autoAppend){var e=this.document.getElementsByTagName("body")[0];e.appendChild(c)}this.use(c,b)},use:function(b,c){c=c||{},c.backgroundColor=c.backgroundColor||"#ffffff",c.clearOnEnterFrame=c.clearOnEnterFrame||!0,this.element=b,this.context=this.element.getContext("2d");var d=this;c.clearOnEnterFrame&&a.on("enterFrame",function(){d.clear()})},clear:function(){this.element&&(this.element.width=this.element.width)}}),a.define("scene",{sceneOptions:null,document:null,init:function(a){this.create(a)},create:function(b){b=b||{},b.document=b.document||a.document,this.sceneOptions=b}}),a.define("move",{speedX:0,speedY:0,accelX:0,accelY:0,moveFriction:.05,moveStop:function(){this.speedX=this.speedY=this.accelX=this.accelY=0},init:function(){a.on("enterFrame",this.move,this,a)},move:function(){this.applyGravity&&a.gravity&&this.applyGravity(),this.speedX+=this.accelX,this.speedY+=this.accelY,this.speedX*=1-this.moveFriction,this.speedY*=1-this.moveFriction,a.level&&a.level.collision(this),this.x+=this.speedX,this.y+=this.speedY},applyGravity:function(){}}),a.define("rect","gfx",{lineWidth:0,lineColor:"#000000",rectColor:"#999999",isVisible:!0,init:function(){},draw:function(a){if(this.isVisible){a||(this._context?a=this._context:(this.getContext(),this._context&&(a=this._context)));var b=this.getDrawBox(),c=this.flipX?-1:1,d=this.flipY?-1:1;if(a&&(a.globalAlpha=this.alpha,this.lineWidth>0&&(a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor,a.strokeRect(b.x,b.y,b.width,b.height)),a.fillStyle=this.rectColor,a.fillRect(b.x,b.y,b.width,b.height),this.debug&&(a.globalAlpha=1,a.lineWidth=.5,a.strokeStyle="#ff1111",a.strokeRect(b.x-.5*c,b.y-.5*d,b.width+1*c,b.height+1*d),a.fillStyle="#999999",this.collisionBox))){var b=this.collisionBox();a.lineWidth=.5,a.strokeStyle="#000099",a.strokeRect(b.x-.5*c,b.y-.5*d,b.width*this.pixelSize+1*c,b.height*this.pixelSize+1*d)}}}}),a.define("image","gfx",{isVisible:!0,images:[],imageSelected:0,imageDefaults:{isInitiated:!1,isReady:!1,src:"",element:null,document:a.document},init:function(){var b=1;this.pixelSize||(this.pixelSize=1),a.isString(this.images)&&(this.images=[{src:this.images}]);for(var c=0;c<this.images.length;c++){a.isString(this.images[c])&&(this.images[c]={src:this.images[c]});for(var d in this.imageDefaults)this.images[c][d]=this.images[c][d]||this.imageDefaults[d];""===this.images[c].name&&(this.images[c].name="image"+b++)}this.imageInit()},resize:function(a,b){var c=a.width*b,d=a.height*b,e=document.createElement("canvas");e.width=a.width,e.height=a.height;var f=e.getContext("2d");f.drawImage(a,0,0);var g=f.getImageData(0,0,a.width,a.height),h=document.createElement("canvas");h.width=c,h.height=d;for(var i=h.getContext("2d"),j=i.getImageData(0,0,c,d),k=0;d>k;k++)for(var l=0;c>l;l++){var m=4*(Math.floor(k/b)*a.width+Math.floor(l/b)),n=4*(k*c+l);j.data[n]=g.data[m],j.data[n+1]=g.data[m+1],j.data[n+2]=g.data[m+2],j.data[n+3]=g.data[m+3]}return i.putImageData(j,0,0),h},image:function(b){if(b==undefined)return this.images[0]?this.imageInit(this.images[0]):null;if("string"==typeof b)b={name:b};else if(a.isInt(b))return this.images[b]?this.imageInit(this.images[b]):null;for(var c=Object.keys(b).length,d=0,e=0;e<this.images.length;e++)for(var f in b)if(this.images[e][f]!==undefined&&b[f]==this.images[e][f]&&d++,d>=c)return this.imageInit(this.images[e]);return null},imageInit:function(b){var c=this;if(b==undefined){for(var d=0;d<this.images.length;d++)this.imageInit(this.images[d]);return!0}return b.isInitiated?b:(b.isReady=!1,b.isInitiated=!0,b.entity=c,b.element=document.createElement("img"),b.element&&(b.element.onload=b.element.onLoad=function(){b.realWidth=this.width,b.realHeight=this.height,b.isReady=!0,a.isUndefined(c.pixelSize)||1==c.pixelSize||(b.element=c.resize(b.element,c.pixelSize),b.realWidth=this.width*c.pixelSize,b.realHeight=this.height*c.pixelSize),c.trigger("imageReady",{target:b}),delete this.onload}),b.changeSource=function(a){return this.element.src=a,c.trigger("change"),!0},b.src!==undefined&&""!==b.src&&b.changeSource(b.src),b)},draw:function(a){if(this.isVisible){a||(this._context?a=this._context:(this.getContext(),this._context&&(a=this._context)));var b=this.image(this.imageSelected),c=this.getDrawBox(),d=this.flipX?-1:1,e=this.flipY?-1:1;if(a&&b&&b.element&&b.isReady&&(a.globalAlpha=this.alpha,a.drawImage(b.element,0,0,b.realWidth,b.realHeight,c.x,c.y,c.width,c.height),this.debug&&(a.globalAlpha=1,a.lineWidth=.5,a.strokeStyle="#ff1111",a.strokeRect(c.x-.5*d,c.y-.5*e,c.width+1*d,c.height+1*e),a.fillStyle="#999999",a.font="10px sans-serif",a.fillText("Image: "+this.imageSelected,c.x,c.y-5),this.collisionBox))){var c=this.collisionBox();a.lineWidth=.5,a.strokeStyle="#000099",a.strokeRect(c.x-.5*d,c.y-.5*e,c.width*this.pixelSize+1*d,c.height*this.pixelSize+1*e)}}}}),a.define("anim","image",{animDefault:{width:32,height:32,name:"",duration:200},animSelected:"",animFrame:0,animSpeed:1,animReady:!1,animWait:!1,animNext:"",init:function(){this.animInit(),this.on("imageReady",function(){this.animFramesInit()})},anims:{},animFramesInit:function(){for(var b in this.anims){var c=this.anims[b];if(!c.isReady){var d=!0;if(c.frames&&c.frames.length)for(var e=0;e<c.frames.length;e++){var f=c.frames[e];if(!(f.isReady||f.image&&f.image.isReady)){f.isReady=!1,d=!1;break}}if(d){c.isReady=!0;var g;if(c.frames&&c.frames.length)for(var e=0;e<c.frames.length;e++){var f=c.frames[e];f.isReady||(a.isUndefined(f.index)&&(f.index=e),a.isUndefined(f.frameIndex)&&(f.frameIndex=e),c.from=c.from||0,g=Math.floor(f.image.realWidth/f.width)/this.pixelSize,console.log("maxLine = "+g),g>0&&(f.x=(c.offsetX||0)*this.pixelSize+(f.frameIndex+c.from%g)*f.width*this.pixelSize,f.y=(c.offsetY||0)*this.pixelSize+Math.floor((f.frameIndex+c.from)/g)*f.height*this.pixelSize,f.isReady=!0,console.log("frame :: t="+e+", frameIndex="+f.frameIndex+", from="+c.from+", maxLine="+g+", x="+f.x+", y="+f.y)))}if(c.extendsTo)for(var e=0;e<c.extendsTo.length;e++)if(this.anims[c.extendsTo[e]]){this.anims[c.extendsTo[e]].isReady=!0,this.anims[c.extendsTo[e]].length=c.length,this.anims[c.extendsTo[e]].frames&&(this.anims[c.extendsTo[e]].oldFrames=a.clone(this.anims[c.extendsTo[e]].frames)),this.anims[c.extendsTo[e]].frames=[];for(var h=0;h<c.frames.length;h++)if(this.anims[c.extendsTo[e]].frames[h]=a.clone(c.frames[h]),this.anims[c.extendsTo[e]].flipX&&(this.anims[c.extendsTo[e]].frames[h].flipX=!this.anims[c.extendsTo[e]].frames[h].flipX),this.anims[c.extendsTo[e]].flipY&&(this.anims[c.extendsTo[e]].frames[h].flipY=!this.anims[c.extendsTo[e]].frames[h].flipY),this.anims[c.extendsTo[e]].oldFrames&&this.anims[c.extendsTo[e]].oldFrames[h])for(var i in this.anims[c.extendsTo[e]].oldFrames[h])this.anims[c.extendsTo[e]].frames[h][i]=this.anims[c.extendsTo[e]].oldFrames[h][i];delete this.anims[c.extendsTo[e]].oldFrames}}}}},animInit:function(){for(var b in this.anims){var c=this.anims[b];if(c.name=b,c.isReady=!1,c.isDefault&&(this.animDefault.name=b,this.animSelected||(this.animSelected=b)),c.extendsFrom)this.anims[c.extendsFrom]&&(this.anims[c.extendsFrom].extendsTo?this.anims[c.extendsFrom].extendsTo.push(b):this.anims[c.extendsFrom].extendsTo=[b]);else if(a.isArray(c.frames)){c.length||(c.length=c.frames.length);for(var d=0;d<c.frames.length;d++)if(a.isInt(c.frames[d])){var e={index:d,frameIndex:c.frames[d],anim:b,duration:c.duration||this.animDefault.duration,flipX:c.flipX||!1,flipY:c.flipY||!1,isReady:!1,width:c.width||this.animDefault.width,height:c.height||this.animDefault.height};a.isUndefined(c.imageIndex)||(e.image=this.image(c.imageIndex)),e.image||a.isUndefined(c.imageName)||(e.image=this.image(c.imageName)),a.isUndefined(e.image)&&(e.image=this.image(0)),c.frames[d]=e}else a.isUndefined(c.imageIndex)||(c.frames[d].image=this.image(c.imageIndex)),c.frames[d].image||a.isUndefined(c.imageName)||(c.frames[d].image=this.image(c.imageName)),a.isUndefined(c.frames[d].image)&&(c.frames[d].image=this.image(0))}else{c.length||(c.length=1),c.from||(c.from=0),c.frames=[];for(var d=0;d<c.length;d++){var e={index:d,frameIndex:d,anim:b,duration:c.duration||this.animDefault.duration,flipX:c.flipX||!1,flipY:c.flipY||!1,isReady:!1,width:c.width||this.animDefault.width,height:c.height||this.animDefault.height};a.isUndefined(c.imageIndex)||(e.image=this.image(c.imageIndex)),a.isUndefined(c.imageName)||(e.image=this.image(c.imageName)),a.isUndefined(e.image)&&(e.image=this.image(0)),c.frames.push(e)}}}this.animFramesInit()},animPlay:function(a,b,c){if(!this.animWait){if(a||(a=this.animDefault.name),this.animSelected==a)return this;if(!this.anims[a])return null;c=c||0,b=b||1;var d=this.anims[a].frames[c];return d?(console.log('playing anim "'+a+'"'),this.animSelected=a,this.animFrame=c,this.animSpeed=b,this.animTime=+new Date+d.duration*b,this.trigger("animStart",{name:this.animSelected,frame:this.animFrame}),this.trigger("animFrame",{name:this.animSelected,frame:this.animFrame}),this):null}},animStop:function(){},animStep:function(){if(this.anims[this.animSelected]&&this.anims[this.animSelected].frames){var a=!1,b=+new Date;if((!this.animTime||isNaN(this.animTime))&&(this.animTime=b),!this.animTime||this.animTime<=b){this.animFrame++,this.animFrame>=this.anims[this.animSelected].frames.length&&(this.animFrame=0,a=!0),this.trigger("animFrame",{name:this.animSelected,frame:this.animFrame});var c=this.anims[this.animSelected].frames[this.animFrame];this.animTime=+new Date+c.duration*this.animSpeed,a&&(this.trigger("animEnd",{name:this.animSelected,frame:this.animFrame}),this.animWait=!1,this.animNext&&""!=this.animNext&&(console.log("animNext = "+this.animNext),this.animPlay(this.animNext)))}}},draw:function(a){if(this.animStep(),this.anims[this.animSelected]||(this.animSelected=this.animDefault.name),this.anims[this.animSelected]&&this.isVisible){a||(this._context?a=this._context:(this.getContext(),this._context&&(a=this._context)));var b=this.anims[this.animSelected].frames[this.animFrame],c=b.image,d=b.flipX?-1:1,e=b.flipY?-1:1;if(this.snapToPixel)var f=parseInt(this.x*d-b.flipX*b.width*this.pixelSize),g=parseInt(this.y*e-b.flipY*b.height*this.pixelSize);else var f=this.x*d-b.flipX*b.width*this.pixelSize,g=this.y*e-b.flipY*b.height*this.pixelSize;var h=b.x,i=b.y;if(a&&c&&c.element&&c.isReady&&((b.flipX||b.flipY)&&(a.save(),a.scale(d,e)),a.globalAlpha=this.alpha,this.isJumping&&console.log("draw :: frame = "+this.animFrame+", animSelected = "+this.animSelected+", x = "+h+", y = "+i+", width = "+b.width+", height = "+b.height+", canvasX = "+f+", canvasY = "+g),a.drawImage(c.element,h,i,b.width*this.pixelSize,b.height*this.pixelSize,f,g,b.width*this.pixelSize,b.height*this.pixelSize),this.debug&&(a.globalAlpha=1,a.lineWidth=.5,a.strokeStyle="#ff1111",a.strokeRect(f-.5*d,g-.5*e,b.width*this.pixelSize+1*d,b.height*this.pixelSize+1*e)),(b.flipX||b.flipY)&&a.restore(),this.debug&&(a.globalAlpha=1,a.fillStyle="#999999",a.font="10px sans-serif",a.fillText("Anim: "+this.animSelected+" / "+this.animFrame,parseInt(this.x),parseInt(this.y-5)),this.collisionBox))){var j=this.collisionBox();a.lineWidth=.5,a.strokeStyle="#000099",a.strokeRect(j.x-.5*d,j.y-.5*e,j.width+1*d,j.height+1*e)}}}}),a.define("collision",{colOffsetX:0,colOffsetY:0,colType:"all",colClass:[],init:function(){a.isUndefined(this.colWidth)&&(this.colWidth=this.width),a.isUndefined(this.colHeight)&&(this.colHeight=this.height)},collisionWith:function(a){return 0==this.colClass.length?!0:a.typeof(this.colClass)?!0:!1},collisionBox:function(){return{x:this.x+this.colOffsetX*this.pixelSize,y:this.y+this.colOffsetY*this.pixelSize,width:this.colWidth*this.pixelSize,height:this.colHeight*this.pixelSize,offsetX:this.colOffsetX*this.pixelSize,offsetY:this.colOffsetY*this.pixelSize}},collision:function(){("all"==this.colType||"active"==this.colType)&&a.collision(this)},collisionOccupy:function(){"none"!=this.colType&&a.collisionOccupy(this)},over:function(a){return this.intersect(a)?this.z>a.z?!0:this.z==a.z&&this.globalZ>a.globalZ?!0:!1:!1},under:function(){return this.intersect(entity)?this.z<entity.z?!0:this.z==entity.z&&this.globalZ<entity.globalZ?!0:!1:!1},touch:function(b){return a.collisionTouch(this,b)},intersect:function(b){return a.collisionCheck(this,b)},inside:function(b){return a.collisionInside(this,b)}}),a.define("text","gfx",{textAlign:"left",textFont:"16px sans-serif",textColor:"#000000",text:"",draw:function(a){if(this.isVisible&&(a||(this._context?a=this._context:(this.getContext(),this._context&&(a=this._context))),a&&(a.globalAlpha=this.alpha,a.fillStyle=this.textColor,a.font=this.textFont,a.fillText(this.text,this.x,this.y),this.debug&&(a.globalAlpha=1,a.lineWidth=.5,a.strokeStyle="#ff1111",a.strokeRect(this.x-.5,this.x-.5,this.width,this.height),this.collisionBox)))){var b=this.collisionBox();a.lineWidth=.5,a.strokeStyle="#000099",a.strokeRect(b.x-.5*scaleX,b.y-.5*scaleY,b.width*this.pixelSize+1*scaleX,b.height*this.pixelSize+1*scaleY)}}}),a.define("actor","anim move collision",{isAttacking:!1,isFalling:!1,isJumping:!1,isOnGround:!1,actorMove:{},actorSpeed:2,actorSpeedMin:.05,actorDirection:"",actorAnims:{},actorInit:function(){},init:function(){},applyFriction:function(){this.speedX*=1-this.moveFriction,this.speedY*=1-this.moveFriction,this.speedX<this.actorSpeedMin&&this.speedX>-this.actorSpeedMin&&(this.speedX=0),this.speedY<this.actorSpeedMin&&this.speedY>-this.actorSpeedMin&&(this.speedY=0)}}),a.define("actor4w","actor",{actorMove:{idle:!0,up:!0,right:!0,down:!0,left:!0,walk:!0,run:!0,jump:!0,damage:!0,crouch:!0,guard:!0,dead:!0,"throw":!0,attack:!0,use:!0,"default":"idle"},actorDirection:"down",actorAnims:{walkup:"walkup",walkright:"walkright",walkdown:"walkdown",walkleft:"walkleft",idleup:"idleup",idleright:"idleright",idledown:"idledown",idleleft:"idleleft",runup:"runup",runright:"runright",rundown:"rundown",runleft:"runleft"},actorInit:function(){},init:function(){}}),a.define("actor2w","actor",{actorMove:{idle:!0,right:!0,left:!0,lookup:!0,lookdown:!0,walk:!0,run:!0,jump:!0,longjump:!0,doublejump:!0,crouch:!0,guard:!0,damage:!0,dead:!0,"throw":!0,attack:!0,use:!0,"default":"idle"},actorSpeedJump:1.1,actorGravity:!0,actorDirection:"right",actorAnims:{idleright:"idleright",idleleft:"idleleft",walkright:"walkright",walkleft:"walkleft",lookup:"lookup",lookdown:"lookdown",lookup:"lookup",lookdown:"lookdown",attackleft:"attackleft",attackright:"attackright",jumpleft:"jumpleft",jumpright:"jumpright",airleft:"airleft",airright:"airright",landleft:"landleft",landright:"landright",left:"left",right:"right"},actorInit:function(){},init:function(){},move:function(){this.speedX+=this.accelX,this.speedY+=this.accelY,this.applyFriction(),this.applyGravity(),a.level&&a.level.collision(this),this.x+=this.speedX,this.y+=this.speedY},applyGravity:function(){return a.gravity?void(!this.isOnGround&&a.gravity&&(a.gravity.x&&(this.speedX+=a.gravity.x/20),a.gravity.y&&(this.speedY+=a.gravity.y/20))):!1},applyFriction:function(){return this.speedX*=1-this.moveFriction,this.speedY*=1-this.moveFriction,this.speedX<this.actorSpeedMin&&this.speedX>-this.actorSpeedMin&&(this.speedX=0),this.speedY<this.actorSpeedMin&&this.speedY>-this.actorSpeedMin&&(this.speedY=0),!0}}),a.define("player2w","actor2w",{actorKeys:{left:"left",right:"right",attack:"x",jump:" "},actorAnims:{idleright:"idleright",idleleft:"idleleft",walkright:"walkright",walkleft:"walkleft",lookup:"lookup",lookdown:"lookdown",jumpleft:"jumpleft",jumpright:"jumpright",airleft:"airleft",airright:"airright",attackleft:"punch1left",attackright:"punch1right"},playerAirFriction:.02,playerGroundFriction:.13,actorOptions:{alwaysRun:!1},init:function(){a.on("enterFrame",function(){var b="";this.accelX=this.actorMove.left&&a.key(this.actorKeys.left)&&!a.key(this.actorKeys.right)?-this.actorSpeed:this.actorMove.right&&a.key(this.actorKeys.right)&&!a.key(this.actorKeys.left)?this.actorSpeed:0,this.actorMove.attack&&a.key(this.actorKeys.attack)&&!this.isAttacking&&(this.isAttacking=!0,b="attack"+this.actorDirection,this.animWait=!1,this.animPlay(this.actorAnims[b]),this.animWait=!0),this.actorMove.jump&&this.isOnGround&&a.key(this.actorKeys.jump)?(b="jump"+this.actorDirection,this.animWait=!1,this.animPlay(this.actorAnims[b]),this.animWait=!0,this.accelY=-this.actorSpeedJump,this.animNext="air"+this.actorDirection,this.isJumping=!0,this.jumpTime=(new Date).getTime(),console.log("this.jumpTime = "+this.jumpTime)):this.isJumping?(console.log("jumpTime = "+this.jumpTime+", now = "+(new Date).getTime()+", +400 ? "+(this.jumpTime+400>(new Date).getTime())),this.accelY=this.jumpTime+200>(new Date).getTime()&&a.key(this.actorKeys.jump)?-(this.actorSpeedJump/6):0):this.accelY=0,this.speedX>0&&this.speedX>=this.speedY&&this.speedX>=-this.speedY?(this.actorDirection="right",this.isOnGround&&(b="walk")):this.speedX<0&&this.speedX<=this.speedY&&this.speedX<=-this.speedY&&(this.actorDirection="left",this.isOnGround&&(b="walk")),this.isOnGround||(this.speedY>0&&(this.isJumping=!1,this.isFalling=!0),b="air"),""==b?b=this.actorMove["default"]+this.actorDirection:b+=this.actorDirection,this.animNext=this.actorAnims[b],this.animWait||this.isAttacking||this.animPlay(this.actorAnims[b])},this,a)},applyFriction:function(){return this.speedX*=1-this.playerGroundFriction,this.speedY*=1-this.playerAirFriction,this.speedX<this.actorSpeedMin&&this.speedX>-this.actorSpeedMin&&(this.speedX=0),this.speedY<this.actorSpeedMin&&this.speedY>-this.actorSpeedMin&&(this.speedY=0),!0}}),a.define("level","gfx",{data:{},isVisible:!0,isReady:!1,layers:[],canvas:null,context:null,block:function(a,b){var c=b*this.data.width+a,d=this.data.layers[0].data[c];return d>1?!0:!1},hit:function(){return!0},collisionRight:function(a,b,c,d){this.hit(c,d,"right",a.speedX),a.x=this.x+c*this.data.tilewidth-1e-4-b.offsetX-b.width,a.speedX=0},collisionLeft:function(a,b,c,d){this.hit(c,d,"left",a.speedX),a.x=this.x+(c+1)*this.data.tilewidth+1e-4-b.offsetX,a.speedX=0},collisionUp:function(a,b,c,d){this.hit(c,d,"up",a.speedY);var e=this.y+(d+1)*this.data.tileheight+1-b.offsetY;a.y=e,a.speedY=0},collisionDown:function(a,b,c,d){this.hit(c,d,"down",a.speedY),a.y=this.y+d*this.data.tileheight-b.offsetY-b.height-1,a.speedY=0,a.isOnGround=!0,a.isJumping=!1,a.isFalling=!1,this.accelY=0},collision:function(a){if(0!=a.speedX||0!=a.speedY){var b=!1,c=!1,d=!1,e=!1,f=a.collisionBox();if(a.speedX>0){var g=Math.floor((f.x+f.width)/this.data.tilewidth),h=Math.floor((f.x+f.width+a.speedX)/this.data.tilewidth);if(h>g){c=!0;for(var i=Math.floor(f.y/this.data.tileheight),j=Math.floor((f.y+f.height)/this.data.tileheight),k=!1,l=g;h>=l;l++){for(var m=i;j>=m;m++)if(this.block(l,m)){this.collisionRight(a,f,l,m),k=!0;break}if(k)break}}}else if(a.speedX<0){var n=Math.floor(f.x/this.data.tilewidth),h=Math.floor((f.x+a.speedX)/this.data.tilewidth);if(n>h){b=!0;for(var i=Math.floor(f.y/this.data.tileheight),j=Math.floor((f.y+f.height)/this.data.tileheight),k=!1,l=n;l>=h;l--){for(var m=i;j>=m;m++)if(this.block(l,m)){this.collisionLeft(a,f,l,m),k=!0;break}if(k)break}}}if(a.speedY>0){var j=Math.floor((f.y+f.height)/this.data.tileheight),h=Math.floor((f.y+f.height+a.speedY)/this.data.tileheight);if(h>j){e=!0;for(var n=Math.floor(f.x/this.data.tilewidth),g=Math.floor((f.x+f.width)/this.data.tilewidth),k=!1,m=j;h>=m;m++){for(var l=n;g>=l;l++)if(this.block(l,m)){this.collisionDown(a,f,l,m),k=!0;break}if(k)break}}}else if(a.speedY<0){var i=Math.floor(f.y/this.data.tileheight),h=Math.floor((f.y+a.speedY)/this.data.tileheight);if(i>h){d=!0;for(var n=Math.floor(f.x/this.data.tilewidth),g=Math.floor((f.x+f.width)/this.data.tilewidth),k=!1,m=i;m>=h;m--){for(var l=n;g>=l;l++)if(this.block(l,m)){this.collisionUp(a,f,l,m),k=!0;break}if(k)break}}}if(!d&&!c&&a.speedX>0&&a.speedY<0){var g=Math.floor((f.x+f.width+a.speedX)/this.data.tilewidth),i=Math.floor((f.y+a.speedY)/this.data.tileheight);this.block(g,i)&&(console.log("Double collision right top"),this.collisionUp(a,f,g,i),this.collisionRight(a,f,g,i))}else if(!e&&!c&&a.speedX>0&&a.speedY>0){var g=Math.floor((f.x+f.width+a.speedX)/this.data.tilewidth),j=Math.floor((f.y+f.height+a.speedY)/this.data.tileheight);this.block(g,j)&&(console.log("Double collision right down"),this.collisionDown(a,f,g,j),this.collisionRight(a,f,g,j))}else if(!e&&!b&&a.speedX<0&&a.speedY>0){var n=Math.floor((f.x+a.speedX)/this.data.tilewidth),j=Math.floor((f.y+f.height+a.speedY)/this.data.tileheight);this.block(n,j)&&(console.log("Double collision left down"),this.collisionDown(a,f,n,j),this.collisionLeft(a,f,n,j))}else if(!d&&!b&&a.speedX<0&&a.speedY<0){var n=Math.floor((f.x+a.speedX)/this.data.tilewidth),i=Math.floor((f.y+a.speedY)/this.data.tileheight);this.block(n,i)&&(console.log("Double collision left up"),this.collisionUp(a,f,n,i),this.collisionLeft(a,f,n,i))}if(0==a.speedY){var j=Math.floor((f.y+f.height)/this.data.tileheight),h=Math.floor((f.y+f.height+1)/this.data.tileheight);if(h==j)a.isOnGround=!1;else{a.isOnGround=!1;for(var n=Math.floor(f.x/this.data.tilewidth),g=Math.floor((f.x+f.width)/this.data.tilewidth),k=!1,m=j;h>=m;m++){for(var l=n;g>=l;l++)if(this.block(l,m)){a.isOnGround=!0,a.isJumping=!1,a.isFalling=!1,this.accelY=0,k=!0;break}if(k)break}}}else a.isOnGround=!1}},load:function(b){a.load(b,{complete:function(b){a.dump(b);var c=b.entity;c.data=JSON.parse(b.content),c.canvas=document.createElement("canvas"),c.context=c.canvas.getContext("2d");var d=0,e=["","","#ff9900","#FF0000","#006600","#000099"];c.canvas.width=c.data.width*c.data.tilewidth,c.canvas.height=c.data.height*c.data.tileheight;for(var f=0;f<c.data.height;f++)for(var g=0;g<c.data.width;g++){var h=c.data.layers[0].data[d];h>1&&(c.context.fillStyle=e[h],c.context.fillRect(g*c.data.tilewidth,f*c.data.tileheight,c.data.tilewidth,c.data.tileheight)),d++}c.isReady=!0,a.level=c},entity:this})},draw:function(a){this.isVisible&&(a||(this._context?a=this._context:(this.getContext(),this._context&&(a=this._context))),a&&this.isReady&&(a.globalAlpha=this.alpha,a.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.canvas.width,this.canvas.height)))}}),a.define("tileset","image",{level:null,load:function(){return level?void 0:!1}}),document.onkeydown=function(b){b=b||window.event,b.code=b.keyCode?b.keyCode:b.which?b.which:b.charCode,a.data.key.pressed[parseInt(b.code)]=!0,a.data.key.hold[parseInt(b.code)]=!0,b.ctrlKey?a.data.key.down[a.data.key.special.ctrl]=!0:a.data.key.hold[a.data.key.special.ctrl]=!1,b.altKey?a.data.key.down[a.data.key.special.alt]=!0:a.data.key.hold[a.data.key.special.alt]=!1,b.shiftKey?a.data.key.down[a.data.key.special.shift]=!0:a.data.key.hold[a.data.key.special.shift]=!1,a.trigger(b.type,b),console.log("trigger "+b.type)},document.onkeyup=function(b){b=b||window.event,b.code=b.keyCode?b.keyCode:b.which?b.which:b.charCode,a.data.key.up[parseInt(b.code)]=!0,a.data.key.hold[parseInt(b.code)]=!1,b.ctrlKey?a.data.key.pressed[a.data.key.special.ctrl]=!0:a.data.key.hold[a.data.key.special.ctrl]=!1,b.altKey?a.data.key.pressed[a.data.key.special.alt]=!0:a.data.key.hold[a.data.key.special.alt]=!1,b.shiftKey?a.data.key.pressed[a.data.key.special.shift]=!0:a.data.key.hold[a.data.key.special.shift]=!1,a.trigger(b.type,b)},document.onkeypress=function(b){b=b||window.event,b.code=b.keyCode?b.keyCode:b.which?b.which:b.charCode,a.data.key.pressed[parseInt(b.code)]=!0,a.trigger(b.type,b)},document.onblur=function(b){a.data.key.pressed={},a.data.key.hold={},a.data.key.down={},a.data.key.up={},a.trigger(b.type,b)},a.on("enterFrame",function(){}),a.on("exitFrame",function(){this.data.key.pressed={},this.data.key.up={},this.data.key.down={}})}yespix.fn=yespix.prototype={init:function(a){function b(a){a.canvas&&e.spawn("canvas",a.canvas),a.fps&&e.setFps(a.fps),this.collisionSize=a.collisionSize,e.isArray(e.entityInstances["/gfx"])?(this.drawEntities=e.entityInstances["/gfx"],this.drawEntities.sort(compare)):this.drawEntities=[],e.on("spawn",function(){this.drawEntitiesChange=!0}),e.on("remove",function(){this.drawEntitiesChange=!0}),e.on("draw",function(){function a(a,b){return a.z>b.z?1:a.z===b.z&&a.zGlobal>b.zGlobal?1:-1}if(e.drawEntitiesChange?(e.drawEntities=e.entityInstances["/gfx"],e.drawEntities&&(e.drawEntities=e.drawEntities.sort(a)),e.drawEntitiesChange=!1):e.drawEntitiesSort&&(e.drawEntities=e.drawEntities.sort(a),e.drawEntitiesSort=!1),e.drawEntities)for(var b=0;b<e.drawEntities.length;b++)e.drawEntities[b]&&e.drawEntities[b].draw&&e.drawEntities[b].draw()}),a.init(),e.trigger("ready")}this.isReady=!1,this.drawEntities=[],this.drawEntitiesChange=!1,this.collisionSize=64,this.on("ready",function(){this.isReady=!0,this.timerStart()}),this.version="0.13";var c=[];this.data={collisionMap:{},file:{},support:{types:{audio:!0,video:!0},extensions:{".3gp":"audio/3gpp",".ac3":"audio/wav",".avi":"video/avi",".kar":"audio/midi",".mid":"audio/midi",".m4a":"audio/x-m4a",".mov":"video/quicktime",".mp3":"audio/mpeg",".mp4":"video/mp4",".mpa":"audio/mpeg",".mpg":"video/mpeg",".webm":"video/webm"},audio:{},video:{},elements:{}},browser:{infos:{name:null,version:null,os:null,mobile:null,initiated:!1},browserList:[{subString:"Chrome",identity:"Chrome"},{subString:"Firefox",identity:"Firefox"},{subString:"Apple",identity:"Safari",version:"Version"},{subString:"MSIE",identity:"IE",version:"MSIE"},{subString:"Opera",identity:"Opera",version:"Version"},{subString:"OmniWeb",identity:"OmniWeb",version:"OmniWeb/"},{subString:"iCab",identity:"iCab"},{subString:"KDE",identity:"Konqueror"},{subString:"Camino",identity:"Camino"},{subString:"Netscape",identity:"Netscape"},{subString:"Gecko",identity:"Mozilla",version:"rv"},{subString:"Mozilla",identity:"Netscape",version:"Mozilla"}],osList:[{subString:"Win",identity:"Windows"},{subString:"Mac",identity:"Mac"},{subString:"iPhone",identity:"iPhone/iPod"},{subString:"Linux",identity:"Linux"}]},key:{pressed:{},up:{},down:{},hold:{},special:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,leftWindowKey:91,rightWindowKey:92,selectKey:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numLock:144,scrollLock:145}}},a=a||{},a.namespace=a.namespace||"yespix",a.dir_resources=a.dir_resources||"resources/",a.dir_engine=a.dir_engine||"yespix/",a.dir_modules=a.dir_modules||"yespix/modules/",a.modules=this.unique(c.concat(a.modules||[])),a.ready=a.ready||function(){},a.init=a.init||function(){},a.collisionSize=a.collisionSize||64,this.on("ready",a.ready),this.options=a,this.document=a.document||document,this.window=a.window||window,initEntities(this);
for(var d=0;d<a.modules.length;d++)/^http(s)?\:\/\//i.test(a.modules[d])||(a.modules[d]=a.dir_modules+a.modules[d],/\.js$/i.test(a.modules[d])||(a.modules[d]=a.modules[d]+".js"));this.options=a,this.window[a.namespace]=this;var e=this;return 0===a.modules.length?(b(a),this):(this.addjs(a.modules,{complete:function(){b(a)},orderedExec:!0}),this)},randFloat:function(a,b){return Math.random()*(b-a)+a},randInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},clone:function(a){var b=new a.constructor;for(var c in a)a!=a[c]&&(b[c]=a[c]);return b},unique:function(a){var b,c={},d=a.length,e=[];for(b=0;d>b;b++)c[a[b]]=a[b];for(b in c)e.push(c[b]);return e},getExtension:function(a){var b=a.split(".").pop();return b==a?"":b},getFilename:function(a){return a.split("/").pop()},getDir:function(a){return-1==a.lastIndexOf("/")?"":a.substring(0,this.lastIndexOf("/")+1)},getNoExtension:function(a){var b=this.getFilename(a);return-1==b.lastIndexOf(".")?b:b.substring(0,b.lastIndexOf("."))},isInt:function(a){return this.isString(a)?!1:parseFloat(a)!=parseInt(a)||isNaN(a)?!1:!0},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},isBoolean:function(a){return"boolean"==typeof a},isUndefined:function(a){return a===undefined||null===a},isString:function(a){return"string"==typeof a},isRegexp:function(a){return a instanceof RegExp},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,"")},xtrim:function(a){return a.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},isFunction:function(a){return a&&"[object Function]"==={}.toString.call(a)},isObject:function(a){return this.isString(a)||this.isArray(a)?!1:null!==a&&"object"==typeof a},pLength:function(a,b){b=b||!0;var c=0;for(var d in a)b?a.hasOwnProperty(d)&&c++:c++;return c},getType:function(a){return null===a?"null":this.isString(a)?"string":this.isArray(a)?"array":this.isObject(a)?"object":typeof a},inArray:function(a,b){return-1!=a.indexOf(b)},each:function(a,b,c){this.isArray(a)||(a=[].slice.call(a));var d=a.length;if(c=c||[],d)if(this.isFunction(b))for(var e in a)b.apply(a[e],c);else if(this.isString(b))for(var e in a)a[e][b]&&this.isFunction(a[e][b])&&a[e][b].apply(a[e],c);return this},dump:function(a,b,c,d){b=b||"",c=c||[],d=d||9,console.group(),console.info("Object dump: "+b);for(var e in a)if(!(this.isObject(a)&&c.length>0)||this.inArray(c,e))if(null===a[e])console.log(" - "+e+" : null");else if("undefined"==typeof a[e])console.log(" - "+e+" = undefined");else if("boolean"==typeof a[e])console.log(" - "+e+' = "'+a[e]+'" (boolean)');else if("number"==typeof a[e])console.log(" - "+e+" = "+a[e]+" (number)");else if("function"==typeof a[e])console.log(" - "+e+" (function)");else if(this.isString(a[e]))console.log(" - "+e+' = "'+a[e]+'" (string)');else if(this.isArray(a[e])){var f="";if(d)for(var g=0;g<a[e].length;g++)if(g>0&&(f+=", "),f+="["+g+"] ",f+=null===a[e][g]?"null":"undefined"==typeof a[e][g]?"undefined":"boolean"==typeof a[e][g]?'"'+a[e][g]+'" (boolean)':"number"==typeof a[e][g]?a[e][g]+" (number)":"string"==typeof a[e][g]?'"'+a[e][g]+'" (string)':"function"==typeof a[e][g]?"function":this.isArray(a[e][g])?"Array ("+a[e][g].length+")":a[e][g],g>d){f+=" ...";break}console.log(""===f?" - "+e+" (array), length "+a[e].length:" - "+e+" (array), length "+a[e].length+", content: "+f)}else if(this.isObject(a[e])){var f="";if(g=0,d)for(var h in a[e])if(!(c.length>0)||this.inArray(c,h)){if(g>0&&(f+=", "),f+="["+g+"] "+h+": ",f+=null===a[e][h]?"null":"undefined"==typeof a[e][h]?"undefined":"boolean"==typeof a[e][h]?'"'+a[e][h]+'" (boolean)':"number"==typeof a[e][h]?a[e][h]+" (number)":"string"==typeof a[e][h]?'"'+a[e][h]+'" (string)':"function"==typeof a[e][h]?"function":this.isArray(a[e][h])?"Array ("+a[e][h].length+")":a[e][h],g>d){f+=" ...";break}g++}console.log(""===f?" - "+e+" (object), length "+this.pLength(a[e]):" - "+e+" (object), length "+this.pLength(a[e])+", content: "+f)}else console.log(" - "+e+' : "'+a[e]+'" ('+typeof a[e]+")");console.groupEnd()},trigger:function(a,b,c){if(!a)return this;if(c=c||this,b=b||{},b.type=a,c._eventList&&c._eventList[a])for(var d=0,e=c._eventList[a].length;e>d;d++){var f=c._eventList[a][d].context||this;c._eventList[a][d].callback.apply(f,[b])}return this},on:function(a,b,c,d){return a&&b?(c=c||this,d=d||c,d._eventList||(d._eventList={}),d._eventList[a]?d._eventList[a].push({name:a,callback:b,context:c}):d._eventList[a]=[{name:a,callback:b,context:c}],this):null},off:function(a,b,c){if(!a)return null;if(this.isObject(b)&&(c=b,b=null),c=c||this,!c._eventList||!c._eventList[a])return this;if(!b)return delete c._eventList[a],this;if(c._eventList[a])for(var d=0,e=c._eventList[a].length;e>d;d++)c._eventList[a][d]&&c._eventList[a][d].callback==b&&(delete c._eventList[a][d],c._eventList[a].splice(d,1),d--);return this},ready:function(a,b){return isReady?a.call(b,{type:"ready"}):on("ready",a,b),this},load:function(a,b,c){function d(a){var b=j.file;if(a.file=b,b.done)return a.size=b.size,a.totalSize=b.size,a.loaded=b.loaded,void(a.progress=b.progress);b.lengthComputable||a.lengthComputable?(b.lengthComputable=!0,b.loaded<a.loaded&&(b.loaded=a.loaded),b.size<a.totalSize&&(b.size=a.totalSize),b.progress=b.size>0?parseInt(b.loaded/b.size*1e4)/100:100,b.progress>100&&(b.progress=100),b.state=100==b.progress?"loaded":"processing"):(b.state="pending",b.loaded=0,b.progress=0,b.size=0,b.lengthComputable=!1);var d={size:b.size,loaded:b.loaded,progress:b.progress,lengthComputable:b.lengthComputable,state:b.state,url:b.url,file:b,entity:c.entity};if(console.log("file.options.entity: "+b.options.entity),b.options)for(var e=0;e<b.options.length;e++)if(b.options[e]){if(b.options[e].stat.loaded=0,b.options[e].stat.progress=0,b.options[e].stat.size=0,b.options[e].stat.allComplete=!0,b.options[e].stat.allSuccess=!0,b.options[e].stat.errorCount=0,b.options[e].fileList)for(var f=0;f<b.options[e].fileList.length;f++){var g=j.yespix.data.file[b.options[e].fileList[f]];if(g&&g.lengthComputable)b.options[e].stat.loaded+=g.loaded,b.options[e].stat.size+=g.size,g.loaded<g.size&&(b.options[e].stat.allComplete=!1);else{if(!g||"error"!=g.state){b.options[e].stat.allComplete=!1,b.options[e].stat.allSuccess=!1,b.options[e].stat.errorCount++;break}b.options[e].stat.allSuccess=!1}}b.options[e].stat.progress=1==b.options[e].stat.allComplete?100:b.options[e].stat.loaded>0?parseInt(b.options[e].stat.loaded/b.options[e].stat.size*1e4)/100:0}return d}if(!a)return this;this.isString(a)&&(a=[a]),this.isObject(b)&&(c=b,b=function(){}),c=c||{},c.complete=c.complete||b||function(){},c.error=c.error||function(){},c.progress=c.progress||function(){},c.skip=c.skip||function(){},c.success=c.success||function(){},c.once=c.once||!1,c.ordered=c.ordered||!1,c.entity=c.entity||yespix;for(var e=a.length,f=0,g={loaded:0,progress:0,size:0,allComplete:!1,allSuccess:!1,errorCount:0};e>f;f++)if(a[f]){if(c[a[f]]){var h=c[a[f]];h=h||{},h.complete=h.complete||c.complete||b||function(){},h.error=h.error||c.error||function(){},h.progress=h.progress||c.progress||function(){},h.skip=h.skip||c.skip||function(){},h.success=h.success||c.success||function(){},h.once=h.once||c.once||!1}else var h=c;if(h.once&&this.data.file[a[f]])this.options.debug&&console.warn('yespix.load: skip the file "'+a[f]+'"'),h.skip({file:this.data.file[a[f]],url:a[f],type:"skip",entity:c.entity});else{h.isLastFile=f==a.length-1,h.isFirstFile=0==f,h.fileList=a,h.stat=g,this.data.file[a[f]]||(this.data.file[a[f]]={loaded:0,progress:0,size:0,done:!1,lengthComputable:!1,options:[]});var i=this.data.file[a[f]];if(this.data.file[a[f]]&&this.data.file[a[f]].state&&"loaded"!=this.data.file[a[f]].state&&"error"!=this.data.file[a[f]].state)i.options&&0!=i.options.length?i.options.push(h):i.options=[h];else{this.data.file[a[f]]={state:"pending",loaded:0,progress:0,size:0,done:!1,lengthComputable:!1,options:[h],url:a[f]};var j=null;if(window.XMLHttpRequest)j=new XMLHttpRequest;else if(window.ActiveXObject){var k=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(var l in k)try{j=new ActiveXObject(k[l]);break}catch(m){}if(!j)return console.error("yespix.load: the browser does not support XMLHTTPRequest"),null}j.yespix=this,j.url=a[f],j.file=this.data.file[a[f]],j.onreadystatechange=function(a){var b=this.file;a.url=this.url;var c=this.readyState||a.type,e=d(a);if(!b.done&&(/load|loaded|complete/i.test(c)||4==c)){if(e.content=this.responseText,e.url=this.url,e.status=this.status,b.done=!0,this.status>=400){this.yespix.options.debug&&console.error('Could not load the file "'+this.url+'"'),e.state=b.state="error";for(var f=0;f<this.file.options.length;f++)e.stat=this.file.options[f].stat,e.type="error",this.file.options[f].error(e),e.type="complete",this.file.options[f].complete(e);return void(this.file.options=[])}e.state=b.state="loaded";for(var f=0;f<this.file.options.length;f++)e.stat=this.file.options[f].stat,e.type="success",this.file.options[f].success(e),e.type="complete",this.file.options[f].complete(e);this.file.options=[]}},j.addEventListener("progress",function(a){if(!i.done){var b=d(a);b.type="progress";for(var c=0;c<this.file.options.length;c++)b.stat=this.file.options[c].stat,this.file.options[c].progress(b)}},!1),j.open("GET",j.url),j.send("")}}}return this},js:function(fileList,complete,options){var e=null;if(!fileList)return this;if(this.isString(fileList)&&(fileList=[fileList]),this.isObject(complete)&&(options=complete,complete=function(){}),options=options||{},options.complete=options.complete||complete||function(){},options.error=options.error||function(){},options.progress=options.progress||function(){},options.success=options.success||function(){},options.skip=options.skip||function(){},options.once=options.once||!1,options.ordered=options.ordered||!1,success=options.success,options.ordered){var token=0;return options.success=function(e){if(fileList[token]==e.file)for(eval(e.content),success(e),token++;fileList[token]&&this.data.file[fileList[token]]&&"loaded"==this.data.file[fileList[token]].state;)eval(this.data.file[fileList[token]].content),success(this.data.file[fileList[token]].eventComplete),token++;else this.data.file[fileList[token]].eventComplete},this.load(fileList,options)}return options.success=function(e){eval(e.content),success(e)},this.load(fileList,options)},css:function(fileList,complete,options){var e=null;if(!fileList)return this;this.isString(fileList)&&(fileList=[fileList]),this.isObject(complete)&&(options=complete,complete=function(){}),options=options||{},options.complete=options.complete||complete||function(){},options.error=options.error||function(){},options.progress=options.progress||function(){},options.skip=options.skip||function(){},options.success=options.success||function(){},options.once=!1,options.ordered=options.ordered||!1,options.document=options.document||this.document||document,complete=options.complete;var error=options.error;if(options.ordered){var token=0;return options.complete=function(e){if(fileList[token]==e.url){var s=document.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=e.url,s.async=!0,delete s.crossOrigin,document.getElementsByTagName("head")[0].appendChild(s),"sheet"in s?(sheet="sheet",cssRules="cssRules"):(sheet="styleSheet",cssRules="rules");var interval_id=setInterval(function(){try{if(s[sheet]&&s[sheet][cssRules].length)for(clearInterval(interval_id),clearTimeout(timeout_id),complete(e),token++;fileList[token]&&this.data.file[fileList[token]]&&"loaded"==this.data.file[fileList[token]].state;)eval(this.data.file[fileList[token]].content),complete(this.data.file[fileList[token]].eventComplete),token++}catch(e){}finally{}},20),timeout_id=setTimeout(function(){for(clearInterval(interval_id),clearTimeout(timeout_id),document.getElementsByTagName("head").removeChild(s),error(e),token++;fileList[token]&&this.data.file[fileList[token]]&&"loaded"==this.data.file[fileList[token]].state;)eval(this.data.file[fileList[token]].content),complete(this.data.file[fileList[token]].eventComplete),token++},15e3)}else this.data.file[e.file].eventComplete=e},this.load(fileList,options)}return options.complete=function(a){var b=document.createElement("link");b.type="text/css",b.rel="stylesheet",b.href=a.url,b.async=!0,delete b.crossOrigin,document.getElementsByTagName("head")[0].appendChild(b),"sheet"in b?(sheet="sheet",cssRules="cssRules"):(sheet="styleSheet",cssRules="rules");var c=setInterval(function(){try{b[sheet]&&b[sheet][cssRules].length&&(clearInterval(c),clearTimeout(d),complete(a))}catch(a){}finally{}},10),d=setTimeout(function(){clearInterval(c),clearTimeout(d),error(a)},15e3)},this.load(fileList,options)},frameIndex:0,frameTime:0,frameMs:1,frameRequest:null,frameRequestId:null,frameTick:null,frameTickNext:(new Date).getTime(),time:+new Date,fps:60,timerStart:function(){this.frameRequest||(this.frameRequest=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setInterval(a,1e3/this.fps)}}()),this.frameMs=1e3/this.fps;var a=this;this.frameTick=function(){a.timerStep(),a.frameTick&&a.frameRequest.call(window,a.frameTick)},this.collisionClear(),this.frameTick(),this.trigger("timerStart")},timerResume:function(){},timerStop:function(){clearInterval(this.frameRequestId),this.frameTick=null,this.trigger("timerStop")},timerStep:function(){for(loops=0,this.frameTime=+new Date,this.frameTime-this.frameTickNext>60*this.frameMs&&(this.frameTickNext=this.frameTime-this.frameMs);this.frameTime>this.frameTickNext;){this.frameIndex++,this.trigger("enterFrame",{frameIndex:this.frameIndex}),this.collisionClear();var a=this.find("/collision");a.length>0&&a.collisionOccupy().collision(),this.frameTickNext+=this.frameMs,loops++}loops&&(this.trigger("draw",{frameIndex:this.frameIndex}),this.trigger("exitFrame",{frameIndex:this.frameIndex}))},currentFps:function(){},getFps:function(){return this.fps},setFps:function(a){this.fps=a,this.frameMs=1e3/this.fps},support:function(a){if(!a)return null;var b=a.split("/");if(1==b.length){if(this.data.support.types[a])return this.data.support.elements[a]||(this.data.support.elements[a]=document.createElement(a)),!!this.data.support.elements[a].canPlayType;if(!this.data.support.extensions[a])return null;a=this.data.support.extensions[a],b=a.split("/")}if(this.data.support[b[0]]!=undefined&&this.data.support[b[0]][b[1]]!=undefined)return this.data.support[b[0]][b[1]];this.data.support.elements[b[0]]==undefined&&(this.data.support.elements[b[0]]=document.createElement(b[0]),0==!!this.data.support.elements[b[0]]&&(this.data.support.elements[b[0]]=!1));var c=this.data.support.elements[b[0]];if(!c||0==!!c.canPlayType)return!1;var d=c.canPlayType(a);return this.data.support[b[0]][b[1]]="no"==d.toLowerCase()||""==d?!1:!0,this.data.support[b[0]][b[1]]},isMobile:function(){return this.data.browser.initiated||this.browser(),this.data.browser.mobile},browser:function(a){function b(a){for(var b=f.data.browser.browserList,c=0;c<b.length;c++)if(-1!=a.indexOf(b[c].subString))return f.data.browser.found=b[c],b[c].identity}function c(a){for(var b=f.data.browser.osList,c=0;c<b.length;c++)if(-1!=a.indexOf(b[c].subString))return f.data.browser.found=b[c],b[c].identity}function d(a){if(f.data.browser.found){var b=f.data.browser.found.version||f.data.browser.infos.name,c=a.indexOf(b);if(-1!=c)return a.substring(c+b.length+1).split(" ").shift()}}function e(a){return f.data.browser.found?/iPhone|iPod|Android|opera mini|blackberry|palm os|palm| Mobile|hiptop|avantgo|plucker|xiino|blazer|elaine|iris|3g_t|windows ce|opera mobi| smartphone;|;iemobile/i.test(a):void 0}var f=this;if(!f.data.browser.initiated){if(f.data.browser.infos.initiated=!0,f.data.browser.infos.name=b(navigator.userAgent)||b(navigator.vendor)||"Unknown browser",f.data.browser.infos.version=d(navigator.userAgent)||d(navigator.appVersion)||"Unknown version","Unknown version"!=f.data.browser.infos.version){var g=f.data.browser.infos.version;f.data.browser.infos.versionMajor=parseInt(g),f.data.browser.infos.versionMinor=-1!=g.indexOf(".")?g.substring(g.indexOf(".")+1):""}f.data.browser.infos.os=c(navigator.platform)||c(navigator.userAgent)||"Unknown OS",f.data.browser.infos.mobile=e(navigator.userAgent)||e(navigator.platform)||!1}return f.data.browser.initiated=!0,a?f.data.browser.infos[a]:f.data.browser.infos},entityRootClassname:"",entityClasses:{},entityInstances:{},entityNextId:1,entityNextClassId:1,find:function(a,b){if(this.isUndefined(a)){var c=this.bunch(this.entityInstances[""]);return b&&this.each(c,b),c}var d={};if(this.isString(a)){if(""===a){var c=this.bunch(this.entityInstances[""]);return b&&this.each(c,b),c}d=this.selectorInit(a)}else{if(this.isInt(a))return this.entityInstances[+a]?this.bunch([this.entityInstances[+a]]):this.bunch();if(this.isObject(a)){if(0==this.pLength(a)){var c=this.bunch(this.entityInstances[""]);return b&&this.each(c,b),c}d=a}}if(this.isArray(d)){var c=[];for(var e in d)c=c.concat(this.find(d[e]).array());return this.bunch(c)}var f=this.pLength(d),c=this.bunch(),g=[];if(d._class&&""!=d._class){if(!this.entityInstances["."+d._class])return this.bunch();if(g=this.entityInstances["."+d._class],1==f)return this.bunch(g)}else if(d._ancestors&&this.isString(d._ancestors)&&""!=d._ancestors){if(!this.entityInstances["/"+d._ancestors])return this.bunch();if(g=this.entityInstances["/"+d._ancestors],1==f)return this.bunch(g)}else g=this.entityInstances[""];for(var h=0;h<g.length;h++){var i=0;for(var e in d)g[h]!==undefined&&g[h][e]!==undefined&&this.selectorCompare(g[h][e],d[e])&&i++,i>=f&&c.push(g[h])}return b&&this.each(c,b),c},selectorInit:function(a){if(-1!=a.indexOf(",")){var b=[],c=a.split(","),b=[];for(var d in c)b.push(this.selectorInit(c[d]));return b}var e={};if(-1!=a.indexOf(" ")){var f=a.split(" ");for(var d in f)""!=f&&(e[this.selectorType(f[d])]?console.warn('entity.selectorInit: ambiguous selector item: "'+f[d]+'" defined twice in "'+a+'"'):e[this.selectorType(f[d])]=this.selectorValue(f[d]))}else e[this.selectorType(a)]=this.selectorValue(a);return e},selectorCompare:function(a,b){return this.isString(b)?this.isArray(a)?this.inArray(a,b):a===b:this.isArray(b)?this.isString(a)?this.inArray(b,a):a===b:this.isRegexp(b)&&this.isString(a)?b.test(a):a===b},selectorType:function(a){return"."==a[0]?"_class":"#"==a[0]?"_id":"/"==a[0]?"_ancestors":"name"},selectorValue:function(a){return"."==a[0]?a.substr(1,a.length):"#"==a[0]?+a.substr(1,a.length):"/"==a[0]?a.substr(1,a.length):a},bunch:function(a){return a&&0!=a.length?new Bunch(a):new Bunch},mixin:function(a,b){for(fn in b)a[fn]=b[fn],this.isFunction(a[fn])&&(Bunch.prototype[fn]=function(a,b){return function(){var c=[].slice.call(arguments);return b.each(this.array(),a,c),this}}(fn,this))},ancestors:function(a){if(this.entityClasses[a]){for(var b=[],c=0;c<this.entityClasses[a].ancestors.length;c++){var d=this.entityClasses[a].ancestors[c];b=b.concat(this.ancestors(d))}return b.push(a),b}return[]},define:function(a,b,c){if(this.entityClasses[a])return void console.warn('define :: entity class name "'+a+'" already exists');"string"!=typeof b&&(c=b,b=this.entityRootClassname),"object"!=typeof c&&(c={}),""==b&&(b=this.entityRootClassname),b=b.split(" ").join(",").split(","),this.entityClasses[a]={ancestors:[],classname:a,properties:c};for(var d=0;d<b.length;d++)""!=b[d]&&(this.entityClasses[b[d]]?b[d]==a?console.warn("define :: entity class cannot add itself to ancestors, skipping"):this.entityClasses[a].ancestors=this.entityClasses[a].ancestors.concat(this.ancestors(b[d])):console.warn('define :: cannot find the entity class name "'+b[d]+'", skipping'));return this.entityClasses[a].ancestors=this.unique(this.entityClasses[a].ancestors),this.trigger("define",{"class":this.entityClasses[a]}),this},spawn:function(a,b){if(b=b===!0?{}:b||{},-1!=a.indexOf(",")){var c=a;a=b.name&&!this.entityClasses[b.name]?b.name:"tempclass"+this.entityNextClassId++,this.define(a,c,b),b={}}if(!this.isDefined(a))return console.warn('spawn :: entity class name "'+a+'" does not exist'),null;for(var d={},e=0;e<this.entityClasses[a].ancestors.length;e++){var f=this.entityClasses[this.entityClasses[a].ancestors[e]];f?this.mixin(d,f.properties):console.warn('spawn :: entity class ancestor "'+this.entityClasses[a].ancestors[e]+'" does not exist for entity class name "'+a+'"')}this.mixin(d,this.entityClasses[a].properties);for(var g in b)d[g]=b[g];if(d._class=a,d._ancestors=this.entityClasses[a].ancestors,d._id=this.entityNextId++,this.instanceAdd(d),this.call(d,"init",[b]),this.isFunction(d.init)&&d.init(b),d._ancestors.length>0)for(e=0;e<d._ancestors.length;e++)this.trigger("spawn:"+d._ancestors[e],{entity:d});return d},instanceAdd:function(a){if(a._instances&&this.instanceRemove(a),a._instances={},this.isUndefined(this.entityInstances[""])||0==this.entityInstances[""].length?(this.entityInstances[""]=[a],a._instances[""]=0):(this.entityInstances[""].push(a),a._instances[""]=this.entityInstances[""].length-1),this.entityInstances[+a._id]=a,this.isUndefined(this.entityInstances["."+a._class])||0==this.entityInstances["."+a._class].length?(this.entityInstances["."+a._class]=[a],a._instances[a._class]=0):(this.entityInstances["."+a._class].push(a),a._instances[a._class]=this.entityInstances["."+a._class].length-1),a._ancestors.length>0)for(var b=0;b<a._ancestors.length;b++)this.isUndefined(this.entityInstances["/"+a._ancestors[b]])||0==this.entityInstances["/"+a._ancestors[b]].length?(this.entityInstances["/"+a._ancestors[b]]=[a],a._instances[a._ancestors[b]]=0):(console.log("add instance to /"+a._ancestors[b]),this.entityInstances["/"+a._ancestors[b]].push(a),a._instances[a._ancestors[b]]=this.entityInstances["/"+a._ancestors[b]].length-1);this.trigger("spawn",{entity:a}),this.trigger("spawn:"+a._class,{entity:a})},instanceRemove:function(a){if(this.entityInstances[""]&&this.entityInstances[""].splice(a._instances[""],1),delete this.entityInstances[+a._id],this.entityInstances["."+a._class]&&this.entityInstances["."+a._class].splice(a._instances[a._class],1),a._ancestors.length>0)for(var b=0;b<a._ancestors.length;b++)this.entityInstances["/"+a._ancestors[b]]&&this.entityInstances["/"+a._ancestors[b]].splice(a._instances[a._ancestors[b]],1);this.trigger("remove",{entity:a}),this.trigger("remove:"+a._class,{entity:a})},isDefined:function(a){return!!this.entityClasses[a]},hasAncestors:function(a,b){if(!this.isDefined(name))return null;this.isString(b)&&(b=[b]);for(var c=0;c<b.length;c++)if(!this.inArray(this.entityClasses[name].ancestors,b[c]))return!1;return!0},call:function(a,b,c,d){if(!this.isDefined(a._class))return null;if(this.isString(c)?c=c.split(","):c&&!d&&(d=c,c=[]),d=d||[],c=c||[],c.length>0&&!this.hasAncestors(a._class,c))return null;0==c.length&&(c=this.entityClasses[a._class].ancestors);for(var e=[],f=0;f<c.length;f++)if(this.entityClasses[c[f]]&&this.entityClasses[c[f]].properties[b]&&this.isFunction(this.entityClasses[c[f]].properties[b]))e.push({name:c[f],status:"called",result:this.entityClasses[c[f]].properties[b].apply(a,d),error:""});else{var g="";g=this.entityClasses[c[f]]?this.entityClasses[c[f]].properties[b]?this.isFunction(this.entityClasses[c[f]].properties[b])?"Unknown error":'Property "'+b+'" is not a function in ancestor entity "'+c[n]+'"':'Ancestor entity "'+c[f]+'" have no "'+b+'" function':'Ancestor entity "'+c[f]+'" does not seem to be defined',e.push({name:c[f],status:"error",result:null,error:g})}return this.trigger("call",{entity:a,fn:b,ancestors:c,params:d,result:e}),e},attach:function(a,b){if(this.isArray(b)){for(var c=0;c<b.length;c++)this.attach(a,b[c]);return this}return b._parent==a?null:(a._children?a._children.push(b):a._children=[b],b._parent&&this.detach(b._parent,b),b._parent=a,this)},detach:function(a,b){if(!b){if(a._children){for(var c=0;c<a._children.length;c++)a._children[c]._parent=null;a._children=null}return this}if(this.isArray(b)){for(var c=0;c<b.length;c++)this.detach(a,b[c]);return this}if(b._parent!=a)return null;b._parent=null;for(var c=0;c<a._children.length;c++)if(a._children[c]==b){a._children.splice(c,1);break}return this},key:function(a,b){if(b=b||"hold",this.isString(a)){if(-1!=a.indexOf("|")&&"\\"!=a.charAt(a.indexOf("|")-1)&&a.length>1){for(var c=a.split("|",2),d=0;d<c.length;d++)if(this.key(c[d],b))return!0;return!1}return-1!=a.indexOf("-")&&"\\"!=a.charAt(a.indexOf("-")-1)&&a.length>1?this.key(a.split("-",2),b):a.length>1?this.specialKey(a,b):("pressed"!=b&&(a=a.toUpperCase()),"hold"==b&&this.data.key.up[a.charCodeAt(0)]?!0:!!this.data.key[b][a.charCodeAt(0)])}if(this.isArray(a)){for(var d=0;d<a.length;d++)if(!this.key(a[d],b))return!1;return!0}return this.isInt(a)?"hold"==b&&this.data.key.up[a]?!0:!!this.data.key[b][a]:!1},isKey:function(a,b){return b.length>1?this.data.key.special[b.toLowerCase()]==a:b.charCodeAt(0)==a||b.toUpperCase().charCodeAt(0)==a||b.toLowerCase().charCodeAt(0)==a},specialKey:function(a,b){return b=b||"hold","hold"==b&&this.data.key.up[this.data.key.special[a.toLowerCase()]]?!0:!!this.data.key[b][this.data.key.special[a.toLowerCase()]]},listen:function(a,b,c){if(this.isArray(b)){for(var d=0;d<b.length;d++)this.listen(a,b[d],c);return!0}if(this.isArray(a)){for(var d=0;d<a.length;d++)this.listen(a[d],b,c);return!0}var e=a[b];c=c||this.listenTrigger,Object.defineProperty?(a["__var_callback_"+b]=c,Object.defineProperty(a,b,{get:function(){return a["__var_new_"+b]},set:function(c){a["__var_old_"+b]=a["__var_new_"+b],a["__var_new_"+b]=c,a["__var_callback_"+b].call(a,a,{target:a,name:b,oldValue:a["__var_old_"+b],newValue:c})}})):"__defineSetter__"in a&&"__defineSetter__"in a?(a._changedCallback=c,a.__defineGetter__(b,function(){return a["__var_new_"+b]}),a.__defineSetter__(b,function(c){a["__var_old_"+b]=a["__var_new_"+b],a["__var_new_"+b]=c,a["__var_callback_"+b].call(a,a,{target:a,name:b,oldValue:a["__var_old_"+b],newValue:c})})):(a["__var_old_"+b]=e,a["__var_new_"+b]=e,a["__var_callback_"+b]=c,this.on("enterFrame",function(){this[b]!=this["__var_new_"+b]&&(this["__var_old_"+b]=this["__var_new_"+b],this["__var_new_"+b]=this[b],this["__var_callback_"+b].call(this,this,{target:this,name:b,oldValue:a["__var_old_"+b],newValue:a["__var_new_"+b]}))},a,this)),a[b]=e},listenTrigger:function(a,b){a._changed=!0,a._changedList||(a._changedList={}),a._changedList[b.name]=!0,a.trigger("change:"+b.name,b)},collisionClear:function(){this.data.collisionMap=[]},collisionCellSize:function(a){1>a&&(a=32),this.collisionSize=a,this.collisionClear()},collisionCell:function(a,b,c){if("canvas"==c)var a=Math.floor(a/this.collisionSize),b=Math.floor(b/this.collisionSize);var d=this.data.collisionMap[a];return d||(d=this.data.collisionMap[a]=[]),d[b]||(d[b]=[]),d[b]},collisionOccupy:function(a){var b=a.collisionBox();if(!(b.width<=0||b.height<=0))for(var c=minCellX=Math.floor(b.x/this.collisionSize),d=minCellY=Math.floor(b.y/this.collisionSize),e=Math.floor((b.x+b.width)/this.collisionSize),f=Math.floor((b.y+b.height)/this.collisionSize);e>=c;){for(d=minCellY;f>=d;)this.collisionAdd(a,c,d),d++;c++}},collisionAdd:function(a,b,c,d){if("canvas"==d)var b=Math.floor(b/this.collisionSize),c=Math.floor(c/this.collisionSize);var e=this.data.collisionMap[b];return e?(e[c]||(e[c]=[],this.key(" ")&&console.log("collisionAdd :: new column, final entity count 1")),e[c].push(a),this.key(" ")&&console.log("collisionAdd :: before unique count "+e[c].length),this.unique(e[c]),this.key(" ")&&console.log("collisionAdd :: final entity count "+e[c].length),!0):(e=this.data.collisionMap[b]=[],e[c]=[a],!0)},collisionCheck:function(a,b){var c=a.collisionBox(),d=b.collisionBox();return c.x+c.width-1<d.x?!1:c.x+1>d.x+d.width?!1:c.y+c.height-1<d.y?!1:c.y+1>d.y+d.height?!1:!0},collisionTouch:function(a,b,c){this.isUndefined(c)&&(c=1);var d=a.collisionBox(),e=b.collisionBox();return this.dump(d,"box1"),this.dump(e,"box2"),d.x+d.width>e.x-c&&d.x+d.width<e.x+c?!0:d.x>e.x+e.width-c&&d.x<e.x+e.width+c?!0:d.y+d.height>e.y-c&&d.y+d.height<e.y+c?!0:d.y>e.y+e.height-c&&d.y<e.y+e.height+c?!0:!1},collisionInside:function(a,b){var c=a.collisionBox(),d=b.collisionBox();return d.x<=c.x&&d.x+d.width>=c.x+c.width&&d.y<=c.y&&d.y+d.height>=c.y+c.height?!0:!1},collision:function(a){var b=[],c=a.collisionBox();if(!(c.width<=0||c.height<=0))for(var d=minCellX=Math.floor(c.x/this.collisionSize),e=minCellY=Math.floor(c.y/this.collisionSize),f=Math.floor((c.x+c.width)/this.collisionSize),g=Math.floor((c.y+c.height)/this.collisionSize);f>=d;){for(e=minCellY;g>=e;){for(var h=this.collisionCell(d,e),i=0;i<h.length;i++)h[i]===a||this.inArray(b,h[i])||a.collisionWith(h[i])&&this.collisionCheck(a,h[i])&&a.trigger("collide",{entity:h[i]}),b.push(h[i]);e++}d++}}},Bunch=function(a){return this instanceof Bunch?void this.__bunch_init.apply(this,arguments):new Bunch(a)},Bunch.prototype=new Array,Bunch.prototype.unique=function(){for(var a=0;a<this.length;a++)for(var b=a+1;b<this.length;b++)this[a]===this[b]&&this.splice(b--,1)},Bunch.prototype.__bunch_init=function(a){if(a&&a.length>0){for(var b=0;b<a.length;b++)this.push(a[b]);this.unique()}},Bunch.prototype.__bunch_each=function(){},Bunch.prototype.array=function(){for(var a=[],b=0;b<this.length;b++)a.push(this[b]);return a},window.yespix=yespix}();