<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Box2D Javascript Fun : 00 : Most Basic Box2D Example</title>
        <script src="../build/yespix.js"></script>
        <script src="engines/box2d.js"></script>
    </head>
    <body>
  
<script>
    // init yespix engine
    yespix();
    var manager = new GfxManager(true);

    var world
        canvas = manager.canvas,
        context = manager.context;
  
    function init() {
       var   b2Vec2 = Box2D.Common.Math.b2Vec2
        , b2BodyDef = Box2D.Dynamics.b2BodyDef
        , b2Body = Box2D.Dynamics.b2Body
        , b2FixtureDef = Box2D.Dynamics.b2FixtureDef
        , b2Fixture = Box2D.Dynamics.b2Fixture
        , b2World = Box2D.Dynamics.b2World
        , b2MassData = Box2D.Collision.Shapes.b2MassData
        , b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape
        , b2CircleShape = Box2D.Collision.Shapes.b2CircleShape
        , b2DebugDraw = Box2D.Dynamics.b2DebugDraw
          ;
     
       world = new b2World(
             new b2Vec2(0, 10)    //gravity
          ,  true                 //allow sleep
       );
       
       var SCALE = 50;
     
       var fixDef = new b2FixtureDef;
       fixDef.density = 1.0;
       fixDef.friction = 0.5;
       fixDef.restitution = 0.2;
     
       var bodyDef = new b2BodyDef;
     
       //create ground
       bodyDef.type = b2Body.b2_staticBody;
       
       // positions the center of the object (not upper left!)
       bodyDef.position.x = canvas.width / 2 / SCALE;
       bodyDef.position.y = (canvas.height / SCALE) - 1;
       
       fixDef.shape = new b2PolygonShape;
       
       // half width, half height. eg actual height here is 1 unit
       fixDef.shape.SetAsBox((canvas.width / SCALE) / 2, 0.5 / 2);
       world.CreateBody(bodyDef).CreateFixture(fixDef);
      
      for (var t=0; t<100; t++) {
         //create dynamic circle object
         bodyDef.type = b2Body.b2_dynamicBody;
         fixDef.shape = new b2CircleShape(
            Math.random() * 0.5 + 0.1 //radius
         );
         bodyDef.position.x = Math.random() * 25;
         bodyDef.position.y = Math.random() * 10;
         world.CreateBody(bodyDef).CreateFixture(fixDef);
         
         // create dynamic polygon object
         bodyDef.type = b2Body.b2_dynamicBody;
         fixDef.shape = new b2PolygonShape;
         fixDef.shape.SetAsBox(
               Math.random() * 0.5 + 0.1 //half width
            ,  Math.random() * 0.5 + 0.1 //half height
         );
         bodyDef.position.x = Math.random() * 25;
         bodyDef.position.y = Math.random() * 10;
         world.CreateBody(bodyDef).CreateFixture(fixDef);
       }

       //setup debug draw
       var debugDraw = new b2DebugDraw();
       debugDraw.SetSprite(context);
       debugDraw.SetDrawScale(SCALE);
       debugDraw.SetFillAlpha(0.3);
       debugDraw.SetLineThickness(1.0);
       debugDraw.SetFlags(b2DebugDraw.e_shapeBit | b2DebugDraw.e_jointBit);
       world.SetDebugDraw(debugDraw);
     
    }; // init()
    



    init();

    //var input = new Input();
    var loop = new Loop(60);
    loop.register(
        function(loop, time) { 
            world.DrawDebugData();
            world.ClearForces();
        }, 
        function(loop, time) { 
            world.Step(
                 time/1000 //frame-rate
              ,  1        //velocity iterations
              ,  1        //position iterations
            );
        }
    ).start();


    
    </script>
    
  </body>
</html>