<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="../build/yespix.js"></script>
    <script type="text/javascript" src="lib/shifty.min.js"></script>
</head>
<body style="background-color: #456;">

<div style="border: 50px solid #146; margin: 50px; width: 800px;">
    <canvas width="800" height="600" id="canvas" style="cursor: none;"></canvas>
</div>
<script type="text/javascript">

	
//var gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads : []);
//if (gamepads) console.log(gamepads); else console.log('no');
//setInterval(function() { console.log(input.gamepads); }, 2000);



    var canvas = document.getElementById('canvas');
    yespix();
    var manager = new yespix.class.gfxManager(canvas);


    var circle = new yespix.entity.path({
        position: {
            x: 400,
            y: 300
        },
        aspect: {
            alpha: 0.1,
            width: 20,
            height: 20
        },
        path: {
            type: 'circle'
        },
        manager: manager
    });

    var position = {};

    var input = new yespix.class.input({key: document, mouse: canvas, gamepad: true});
    input.when('mousemove', function(e) {
        cursorMove(e);
    });
    input.when('mousedown', function(e) {
        cursorClick(e);
    });
    input.when('keydown', function(e) {
        console.log('key '+e.inputCode);
    });

    // create loop
    var loop = new yespix.class.loop(60);

    var list = [];
    var index = 0;

    function cursorMove(e) {
        circle.position.set({
            x: e.offsetX-10,
            y: e.offsetY-10
        });
        if (input.mouse('left')) {
            cursorClick(e);
        }
    }

    function cursorClick(e) {
        if (yespix.isUndefined(position.x)) {
            position = {
                x: e.offsetX,
                y: e.offsetY
            };
        } else {
            list.push(new yespix.entity.path({
                position: {
                    x: e.offsetX,
                    y: e.offsetY
                },
                aspect: {
                    alpha: 1.0
                },
                path: {
                    type: 'line',
                    lineColor: '#123456',
                    lineWidth: 10,
                    lineCap: 'round',
                    points: {x: position.x-e.offsetX, y: position.y-e.offsetY}
                },
                manager: manager
            }));
            position = {
                x: e.offsetX,
                y: e.offsetY
            };
        }
    }

    var square = new yespix.entity.path({
        position: {
            x: 100,
            y: 100
        },
        aspect: {
            width: 100,
            height: 100
        },
        path: {
            type: 'rect',
            lineColor: '#333',
            lineWidth: 1,
            fillColor: '#990000'
        },
        manager: manager
    });
    var eText = new yespix.entity.text({
        position: {
            x: 130,
            y: 110,
            z: 100
        },
        aspect: {
            width: 100,
            height: 100
        },
        text: {
            align: 'center',
            size: 64,
            content: '0',
            fillColor: '#000000'
        },
        manager: manager
    });

    function myGamepad() {
        if (eText.isReady) {
            for (var name in input.gamepadMap.standard) {
                if (input.gamepad(name)) {
                    square.path.set({fillColor: '#ff0000'});
                    eText.text.set({content: name})
                    console.log(name);
                }
            }
        }
    }



    // register tick and frame functions
    loop.register(
        function(loop, time) { 
            //cursorMove();
            manager.clear(); // clear canvas
            myGamepad();
            manager.draw(); // draw debug
            //manager.drawDebug(); // draw debug
            manager.drawFps(time, 30);
        }, 
        function(loop, time) { 
            //manager.step(time);
            //manager.applyPhysics(time); // apply position from physics engine
        }
    ).start();


   
 
</script>
</body>
</html>
