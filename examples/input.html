<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="../build/yespix.js"></script>
</head>
<body style="background-color: #456;">

<div style="border: 50px solid #146; margin: 50px; width: 800px;">
    <canvas width="800" height="600" id="canvas" style="cursor: none;"></canvas>
</div>
<script type="text/javascript">

	



    var game = new yespix.class.game({
        fps: 60,
        canvas: 'canvas',
        debug: true,
        input: true
    });


    // register new frame and step functions
    game.loop.register(
        function(loop, time) { 
            game.gfxManager.clear();            // clear canvas
            myGamepad(game);                    // check gamepad
            game.gfxManager.draw();             // draw
            game.gfxManager.drawFps(time, 60);  // debug
        }, 
        function(loop, time) { 
        }
    );


    var square = new yespix.entity.path({
        position: {
            x: 100,
            y: 100
        },
        aspect: {
            width: 100,
            height: 100
        },
        path: {
            type: 'rect',
            lineColor: '#333',
            lineWidth: 1,
            fillColor: '#990000'
        },
        manager: game.gfxManager
    });
    
    var eText = new yespix.entity.text({
        position: {
            x: 130,
            y: 110,
            z: 100
        },
        aspect: {
            width: 100,
            height: 100
        },
        text: {
            align: 'center',
            size: 64,
            content: '0',
            fillColor: '#000000'
        },
        manager: game.gfxManager
    });

    var circle = new yespix.entity.path({
        position: {
            x: 400,
            y: 300
        },
        aspect: {
            alpha: 0.1,
            width: 20,
            height: 20
        },
        path: {
            type: 'circle'
        },
        manager: game.gfxManager
    });

    var position = {};

    game.input.when('mousemove', function(e) {
        cursorMove(e);
    });
    game.input.when('mousedown', function(e) {
        cursorClick(e);
    });
    game.input.when('keydown', function(e) {
        console.log('key '+e.inputCode);
    });


    function cursorMove(e) {
        circle.position.set({
            x: e.offsetX-10,
            y: e.offsetY-10
        });
        if (game.input.mouse('left')) {
            cursorClick(e);
        }
    }

    function cursorClick(e) {
        if (yespix.isUndefined(position.x)) {
            position = {
                x: e.offsetX,
                y: e.offsetY
            };
        } else {
            new yespix.entity.path({
                position: {
                    x: e.offsetX,
                    y: e.offsetY
                },
                path: {
                    type: 'line',
                    lineColor: '#123456',
                    lineWidth: 10,
                    lineCap: 'round',
                    points: {x: position.x-e.offsetX, y: position.y-e.offsetY}
                },
                manager: game.gfxManager
            });
            position = {
                x: e.offsetX,
                y: e.offsetY
            };
        }
    }



    function myGamepad(game) {
        if (eText.isReady) {
            for (var name in game.input.gamepadMap.standard) {
                if (game.input.gamepad(name)) {
                    square.path.set({fillColor: '#ff0000'});
                    eText.text.set({content: name})
                }
            }
        }
    }


    
    

   
 
</script>
</body>
</html>
