<!DOCTYPE html>
<html>
	<head>
	    <script src="engines/box2d.js"></script>
		<script src="../build/yespix.js"></script>
	</head>
	<body style="background-color: #789;">
		<script type="text/javascript">
	

	// init yespix engine
	yespix();

	// create gfx manager
	var manager = new GfxManager(true);
    manager.setEngine(new EngineBox2d());

	//////////////////////////////////////////////////////////////////////////////
	// UNIT TEST ENTITY EXTENDS
	//////////////////////////////////////////////////////////////////////////////
	// image+actor
	var object = new yespix.class.image(
		{
			image: 
			{
				src: 'unit/image/zardoz.png', 
				snapToPixel: true
			}
		});
	
	object.actor = new yespix.class.actor2w({}, object);
	
	object.collision = new Collision(
		{
			offsetX: 10,
			offsetY: 5,
			width: 130,
			height: 145,
			engine: manager.engine, 
			fixedRotation: true,
			friction: 0.8,
			linearDamping: 1.0
		}, object);

	manager.add(object);


	object = new yespix.class.image(
		{
			image: 
			{
				src: 'unit/image/zardoz.png', 
				snapToPixel: true
			},
			aspect:
			{
				width: 20,
				height: 40
			},
			position: 
			{
				x: 200
			}
		});
	
	object.collision = new Collision(
		{
			friction: 1.1,
			engine: manager.engine, 
		}, object);

	manager.add(object);

	//////////////////////////////////////////////////////////////////////////////
    manager.engine.createRect(0, 400, 640, 10, {type: 'static'});


	//var actor = new yespix.class.actor({ image: 'unit/image/perso.png', sprite: { width: 32, height: 32 } });
	//actor.extend(yespix.class.image);
	//actor.extend(yespix.class.sprite);
	//manager.add(actor);
//	actor.extend(yespix.class.image);
console.log('object = ', object);





	//////////////////////////////////////////////////////////////////////////////
	// UNIT ElementList
	//////////////////////////////////////////////////////////////////////////////
	// create 1
	//var object = new ElementList({});
	//object.add({test: 'test'});
	//console.log(object);
	//////////////////////////////////////////////////////////////////////////////
	// create 3
	//var object = new ElementList({});
	//object.add({test: 'test 1'});
	//object.add({test: 'test 2'});
	//object.add({test: 'test 3'});
	//console.log(object);
	//////////////////////////////////////////////////////////////////////////////
	

	//////////////////////////////////////////////////////////////////////////////
	// UNIT TEST PATH
	//////////////////////////////////////////////////////////////////////////////
	// simple
	//manager.add(new yespix.class.path({aspect: {width: 100, height: 100}, position: {x: 100, y: 100}}));
	//////////////////////////////////////////////////////////////////////////////
	// rotation
	//manager.add(new yespix.class.path({aspect: {width: 100, height: 100}, position: {x: 100, y: 100, rotation: 45}}));
	//////////////////////////////////////////////////////////////////////////////
	// border radius
	//manager.add(new yespix.class.path({aspect: {width: 100, height: 100}, position: {x: 100, y: 100}, path: {borderRadius: 20}}));
	//manager.add(new yespix.class.path({aspect: {width: 30, height: 10}, position: {x: 300, y: 100}, path: {borderRadius: 10}}));
	

	//////////////////////////////////////////////////////////////////////////////
	// UNIT TEST TEXT
	//////////////////////////////////////////////////////////////////////////////
	// simple
	//manager.add(new yespix.class.text({text: {content: 'COOOOL!!', fillColor: '#123456'}, position: {x: 100, y: 100}}));
	//////////////////////////////////////////////////////////////////////////////
	// rotation
	//manager.add(new yespix.class.path({path: {fillColor: '#987654'}, aspect: {width: 0, height: 100}, position: {x: 100, y: 100}}));
	//manager.add(new yespix.class.path({path: {fillColor: '#987654'}, aspect: {width: 0, height: 100}, position: {x: 200, y: 100}}));
	//manager.add(new yespix.class.path({path: {fillColor: '#987654'}, aspect: {width: 0, height: 100}, position: {x: 300, y: 100}}));
	//manager.add(new yespix.class.path({path: {fillColor: '#987654'}, aspect: {width: 0, height: 100}, position: {x: 400, y: 100}}));
	//manager.add(new yespix.class.text({text: {content: 'COOOOL!!', fillColor: '#123456'}, position: {x: 100, y: 100, rotation: 00}}));
	//manager.add(new yespix.class.text({text: {content: 'COOOOL!!', fillColor: '#123456'}, position: {x: 200, y: 100, rotation: 10}}));
	//manager.add(new yespix.class.text({text: {content: 'COOOOL!!', fillColor: '#123456'}, position: {x: 300, y: 100, rotation: 45}}));
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//manager.clear();
	//manager.draw();
	//////////////////////////////////////////////////////////////////////////////



	//////////////////////////////////////////////////////////////////////////////
	// UNIT TEST IMAGE
	//////////////////////////////////////////////////////////////////////////////
	// options as string
	//manager.add(new yespix.class.image('unit/image/sean.png'));
	//////////////////////////////////////////////////////////////////////////////
	// image as string
	//manager.add(new yespix.class.image({image: 'unit/image/zardoz.png'}));
	//////////////////////////////////////////////////////////////////////////////
	// src as string
	//manager.add(new yespix.class.image({image: {src: 'unit/image/sean.png', scale: 2.0}}));
	//////////////////////////////////////////////////////////////////////////////
	// scale after load
	//manager.add(new yespix.class.image('unit/image/sean.png'));
	//setTimeout(function () { manager.list[0].image.set({scale: 2.0}); }, 2000);
	//////////////////////////////////////////////////////////////////////////////
	// dont load
	//manager.add(new yespix.class.image('unit/image/sean.png'));
	//console.log('isLoading? ', manager.list[0].image.isLoading, ', isReady? ', manager.list[0].image.isReady);
	//manager.loadAssets();
	//console.log('isLoading? ', manager.list[0].image.isLoading, ', isReady? ', manager.list[0].image.isReady);
	//setTimeout(function () { console.log('isLoading? ', manager.list[0].image.isLoading, ', isReady? ', manager.list[0].image.isReady); }, 2000);
	//////////////////////////////////////////////////////////////////////////////
	// handle multiple images
	//var objects = {
	//	zardoz: new yespix.class.image({image: {src: 'unit/image/zardoz.png', scale: 2.0}, position: {z: 20}}),
	//	sean: new yespix.class.image({image: {src: 'unit/image/sean.png', scale: 1.0}, position: {z: 10}})
	//};
	//manager.add(objects.zardoz, objects.sean);
	//////////////////////////////////////////////////////////////////////////////
	// clip
	//manager.add(new yespix.class.image('unit/image/zardoz.png'));
	//manager.list[0].set({aspect: {clipX: 20, clipY: 20, clipWidth: 20, clipHeight: 20, width: 20, height: 20}, image: {autoSize: false}});
	//////////////////////////////////////////////////////////////////////////////
	// change size
	//manager.add(new yespix.class.image('unit/image/zardoz.png'));
	//manager.list[0].set({aspect: {width: 20, height: 20}});
	//////////////////////////////////////////////////////////////////////////////
	// clipping
	//for (var t=0; t<2; t++) {
	//	var image = new yespix.class.image({id: "0"+t, image: {src: 'unit/image/zardoz.png', scale: 2}, position: {x: yespix.randInt(100, 300), y: yespix.randInt(100, 300)}, aspect: {isVisible: false}});
	//	manager.add(image);
	//	image.collision = new Collision({offsetX: 0, offsetY: 0, width: 10, height: 10}, image);
	//}
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	/*
	var input = new Input();
	var loop = new Loop(100);
	loop.register(
		function(loop, time) { 
			if (input.key('a')) {
				var list = '';
				for (var t=0; t<manager.list.length; t++) {
					if (list!='') list += ', ';
					list += manager.list[t].id;
				}
				console.log('list = '+list);
			}
            manager.applyPhysics(); // apply position from physics engine
            //manager.clear(); // clear canvas
            //manager.engine.world.DrawDebugData(); // draw debug
            manager.draw(); // draw entities
		}, 
		function(loop, time) { 
		}
	).start();
	*/
	//////////////////////////////////////////////////////////////////////////////


	//////////////////////////////////////////////////////////////////////////////
	// UNIT TEST SOUND
	//////////////////////////////////////////////////////////////////////////////
	// options as string
	//manager.add(new yespix.class.sound('unit/sound/wilhelm.ogg'));
	//manager.list[0].sound.autoPlay = true;
	//////////////////////////////////////////////////////////////////////////////
	// sound as string
	//manager.add(new yespix.class.sound({sound: 'unit/sound/wilhelm.ogg'}));
	//manager.list[0].sound.autoPlay = true;
	//////////////////////////////////////////////////////////////////////////////
	// dont load before play
	//manager.add(new yespix.class.sound('unit/sound/wilhelm.ogg'));
	//console.log('isLoading? ', manager.list[0].sound.isLoading, ', isReady? ', manager.list[0].sound.isReady);
	//manager.loadAssets();
	//console.log('isLoading? ', manager.list[0].sound.isLoading, ', isReady? ', manager.list[0].sound.isReady);
	//setTimeout(function () { console.log('isLoading? ', manager.list[0].sound.isLoading, ', isReady? ', manager.list[0].sound.isReady); manager.list[0].sound.play(); }, 2000);
	//////////////////////////////////////////////////////////////////////////////
	// autoplay
	//manager.add(new yespix.class.sound('unit/sound/wilhelm.ogg'));
	//manager.list[0].sound.autoPlay = true;
	//console.log('isLoading? ', manager.list[0].sound.isLoading, ', isReady? ', manager.list[0].sound.isReady);
	//setTimeout(function () { console.log('isLoading? ', manager.list[0].sound.isLoading, ', isReady? ', manager.list[0].sound.isReady); }, 2000);
	//////////////////////////////////////////////////////////////////////////////
	// autoload
	//manager.add(new yespix.class.sound('unit/sound/wilhelm.ogg'));
	//manager.list[0].sound.autoLoad = true;
	//console.log('isLoading? ', manager.list[0].sound.isLoading, ', isReady? ', manager.list[0].sound.isReady);
	//setTimeout(function () { console.log('isLoading? ', manager.list[0].sound.isLoading, ', isReady? ', manager.list[0].sound.isReady); }, 2000);
	//////////////////////////////////////////////////////////////////////////////
	// no autoload nor autoload
	//manager.add(new yespix.class.sound('unit/sound/wilhelm.ogg'));
	//console.log('isLoading? ', manager.list[0].sound.isLoading, ', isReady? ', manager.list[0].sound.isReady);
	//setTimeout(function () { console.log('isLoading? ', manager.list[0].sound.isLoading, ', isReady? ', manager.list[0].sound.isReady); }, 2000);
	//////////////////////////////////////////////////////////////////////////////
	

	//////////////////////////////////////////////////////////////////////////////
	// UNIT TEST SPRITE
	//////////////////////////////////////////////////////////////////////////////
	// simple	
	//manager.add(new yespix.class.sprite({ image: 'unit/image/perso.png', sprite: { width: 32, height: 32 } }));
	//////////////////////////////////////////////////////////////////////////////
	// frame select
	//manager.add(new yespix.class.sprite({ image: 'unit/image/perso.png', sprite: { width: 32, height: 32 } }));
	//manager.list[0].sprite.select(3);
	//////////////////////////////////////////////////////////////////////////////
	// image object and scale
	//manager.add(new yespix.class.sprite({ image: {src: 'unit/image/perso.png', scale: 2}, sprite: { width: 32, height: 32 } }));
	//manager.list[0].sprite.select(3);
	//////////////////////////////////////////////////////////////////////////////
	// offset
	/*manager.add(new yespix.class.sprite({ 
		image: {src: 'unit/image/perso.png', scale: 2}, 
		sprite: { width: 32, height: 32, frames: 
			[
				{x: 00, y: 00, offsetX: 00, offsetY: 10}, 
				{x: 32, y: 32, offsetX: 10, offsetY: 00}
			]
		}
	}));
	manager.list[0].sprite.select(0);
	setTimeout(function () { manager.list[0].sprite.select(1); }, 2000);*/


	//////////////////////////////////////////////////////////////////////////////
	// UNIT TEST LOOP
	//////////////////////////////////////////////////////////////////////////////
	// loop on console 1/sec
	//var loop = new Loop(60);
	//loop.register(
	//	function(loop, time) { manager.clear(); manager.draw(); }, 
	//	function(loop, time) { manager.list[0].position.x += 0.2 * time; }
	//);
	//loop.start();
	//setTimeout(function () { loop.stop(); }, 2000);
	//console.log('loop = ', loop);


	//////////////////////////////////////////////////////////////////////////////
	// UNIT TEST VIDEO
	//////////////////////////////////////////////////////////////////////////////
	// options as string
	//manager.add(new yespix.class.video('unit/video/video.ogv'));
	//////////////////////////////////////////////////////////////////////////////
	// image as string
	//manager.add(new yespix.class.video({video: 'unit/video/video.ogv'}));
	//////////////////////////////////////////////////////////////////////////////
	// src as string
	//manager.add(new yespix.class.video({video: {src: 'unit/video/video.ogv', autoLoad: true}}));
	//////////////////////////////////////////////////////////////////////////////
	// dont load
	//manager.add(new yespix.class.video({video: {src: 'unit/video/video.ogv', autoLoad: false}}));
	//console.log('isLoading? ', manager.list[0].video.isLoading, ', isReady? ', manager.list[0].video.isReady);
	//manager.loadAssets();
	//console.log('isLoading? ', manager.list[0].video.isLoading, ', isReady? ', manager.list[0].video.isReady);
	//setTimeout(function () { console.log('isLoading? ', manager.list[0].video.isLoading, ', isReady? ', manager.list[0].video.isReady); }, 2000);
	//////////////////////////////////////////////////////////////////////////////
	// handle multiple entities
	//var objects = {
	//	test: new yespix.class.video({video: {src: 'unit/video/video.ogv', loop: true}, position: {z: 20}}),
	//	zardoz: new yespix.class.image({image: 'unit/image/zardoz.png', position: {x: 80, y: 20, z: 30}})
	//};
	//manager.add(objects.test, objects.zardoz);
	//////////////////////////////////////////////////////////////////////////////
	// clip
	//manager.add(new yespix.class.video('unit/video/video.ogv'));
	//manager.list[0].set({aspect: {clipX: 95, clipY: 40, clipWidth: 50, clipHeight: 50, width: 50, height: 50}, video: {autoSize: false}});


	//////////////////////////////////////////////////////////////////////////////
	// UNIT TEST ANIMATION
	//////////////////////////////////////////////////////////////////////////////
	// simple	
	/*manager.add(new yespix.class.animation({
		animation: {
			defaultAnimation: 'runLeft',
			defaultSprite: 'perso',
			defaultDuration: 200,
			sprites: { 
				'perso': {
					image: {src: 'unit/image/perso.png', scale: 5},
					sprite: { width: 32, height: 32 }
				}
			},
			list: {
				'runLeft': { frames: [3, 4, 3, 5] }
			}
		}
	}));*/
	//////////////////////////////////////////////////////////////////////////////
	// flipX flipY
	/*manager.add(new yespix.class.animation({
		animation: {
			defaultAnimation: 'runLeft',
			defaultSprite: 'perso',
			defaultDuration: 2000,
			sprites: { 
				'perso': {
					image: 'unit/image/perso.png', 
					sprite: { width: 32, height: 32 }
				}
			},
			list: {
				'runLeft': { frames: [3, 4, 3, 5], flipX: true, flipY: true }
			}
		}
	}));*/
	//////////////////////////////////////////////////////////////////////////////
	// multiple sprites
	/*manager.add(new yespix.class.animation({
		animation: {
			defaultAnimation: 'idle',
			defaultSprite: 'perso',
			defaultDuration: 2000,
			sprites: { 
				'perso': {
					image: 'unit/image/perso.png', 
					sprite: { width: 32, height: 32 }
				},
				'girl': {
					image: 'unit/image/girl.png', 
					sprite: { width: 21, height: 20, x: 28, y: 19, maxLines: 5, maxCols: 6 }
				}
			},
			list: {
				'idle': { frames: [{sprite: 'girl', frame: 0}, {sprite: 'girl', frame: 1}, {sprite: 'girl', frame: 2}, {sprite: 'perso', frame: 2}] }
			}
		}
	}));*/
	//////////////////////////////////////////////////////////////////////////////
	// scale image
	/*manager.add(new yespix.class.animation({
		animation: {
			defaultAnimation: 'run',
			defaultSprite: 'perso',
			defaultDuration: 1000,
			sprites: { 
				'perso': {
					image: {src: 'unit/image/perso.png', scale: 3},
					sprite: { width: 32, height: 32 }
				}
			},
			list: {
				'run': { frames: [3,4,3,5] }
			}
		}
	}));*/
	//////////////////////////////////////////////////////////////////////////////
	// multiple animations
	/*manager.add(new yespix.class.animation({
		animation: {
			defaultAnimation: 'idle',
			defaultSprite: 'perso',
			defaultDuration: 200,
			sprites: { 
				'perso': {
					image: 'unit/image/perso.png', 
					sprite: { width: 32, height: 32 }
				},
			},
			list: {
				'idle': { frames: [0] },
				'runleft': { frames: [1,0,2,0] },
				'runright': { frames: [4,3,5,3], flipX: true }
			}
		}
	}));
	setTimeout(function () { manager.list[0].animation.play('runleft'); }, 3000);
	setTimeout(function () { manager.list[0].animation.play('runright');  }, 6000);*/
	//////////////////////////////////////////////////////////////////////////////
	// frame with different shapes
	/*manager.add(new yespix.class.animation({
		animation: {
			defaultAnimation: 'idle',
			defaultSprite: 'joconde',
			defaultDuration: 2000,
			sprites: { 
				'joconde': {
					image: {src: 'unit/image/joconde.png', scale: 3},
					sprite: { 
						frames: [
							{x:35, y: 34, width: 26, height: 24},
							{x:65, y:  2, width: 58, height: 45},
							{x: 4, y: 74, width: 58, height: 30},
							{x:70, y: 99, width: 14, height: 14},
							{x:95, y: 50, width: 20, height: 52}
						]
					}
				},
			},
			list: {
				'idle': { frames: [0, 1, 2 ,3 ,4] }
			}
		}
	}));*/
	//////////////////////////////////////////////////////////////////////////////
	// frame with different offsets
	/*manager.add(new yespix.class.animation({
		animation: {
			defaultAnimation: 'runleft',
			defaultSprite: 'perso',
			defaultDuration: 1000,
			sprites: { 
				'perso': {
					image: {src: 'unit/image/perso.png', scale: 2},
					sprite: { 
						frames: [
							{x: 00, y: 00, offsetX: 00, offsetY: 00},
							{x: 32, y: 00, offsetX: 10, offsetY: 00},
							{x: 64, y: 00, offsetX: 20, offsetY: 00},
							{x: 00, y: 32, offsetX: 30, offsetY: 00},
							{x: 32, y: 32, offsetX: 40, offsetY: 10},
							{x: 64, y: 32, offsetX: 50, offsetY: 20}
						], width: 32, height: 32
					}
				},
			},
			list: {
				'runleft': { frames: [0, 1, 2, 3, 4, 5] }
			}
		}
	}));*/
	//////////////////////////////////////////////////////////////////////////////
	// extends animation
	/*manager.add(new yespix.class.animation({
		animation: {
			defaultAnimation: 'idle',
			defaultSprite: 'perso',
			defaultDuration: 200,
			sprites: { 
				'perso': {
					image: 'unit/image/perso.png', 
					sprite: { width: 32, height: 32 }
				},
			},
			list: {
				'idle': { frames: [0] },
				'runleft': { frames: [1,0,2,0] },
				'runright': { extends: 'runleft', flipX: true, duration: 100 }
			}
		}
	}));
	setTimeout(function () { manager.list[0].animation.play('runleft'); }, 3000);
	setTimeout(function () { manager.list[0].animation.play('runright');  }, 6000);
	*/
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	/*
	var input = new Input();
	var loop = new Loop(100);
	loop.register(
		function(loop, time) { manager.clear(); manager.draw(); }, 
		function(loop, time) { }
	).start();
	*/
	//////////////////////////////////////////////////////////////////////////////

	//////////////////////////////////////////////////////////////////////////////
	// UNIT TEST INPUT
	//////////////////////////////////////////////////////////////////////////////
	// simple
	/*
	var input = new Input();
	var loop = new Loop(1);
	loop.register(
		function(loop, time) { if (input.key('right')) console.log('ok'); }, 
		function(loop, time) { }
	).start();
	setInterval(function () { console.log(input.key('left'), input);   }, 5000);
	*/



	//////////////////////////////////////////////////////////////////////////////
	// UNIT TEST BOX2D
	//////////////////////////////////////////////////////////////////////////////
	// simple
	
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	/*
	var input = new Input();
	var loop = new Loop(1);
	loop.register(
		function(loop, time) { }, 
		function(loop, time) { }
	).start();
	*/
	//////////////////////////////////////////////////////////////////////////////



	//////////////////////////////////////////////////////////////////////////////
	// UNIT TEST ACTOR
	//////////////////////////////////////////////////////////////////////////////
	// simple
	//////////////////////////////////////////////////////////////////////////////
	//var actor = new yespix.class.actor({extendClasses: ['path'], position: {x: 100, y: 100}, aspect: {width: 100, height: 100}, collision: {width: 100, height: 100}, path: {fillColor: '#012345'}});
	//manager.add(actor);

	//////////////////////////////////////////////////////////////////////////////
	
	var input = new Input();
	var loop = new Loop(100);
	loop.register(
		function(loop, time) { 
            manager.applyPhysics(); // apply position from physics engine
            manager.clear(); // clear canvas
            manager.engine.world.DrawDebugData(); // draw debug
            manager.draw(); // draw entities
            manager.engine.world.ClearForces();
		}, 
		function(loop, time) { 
			manager.engine.world.Step(time/1000, 100, 100);
		}
	).start();
	
	//////////////////////////////////////////////////////////////////////////////





	manager.load();

	/*
	manager.when('ready', function(e) {
		manager.draw();
		console.log('GfxManager:ready!');
	});
	*/

	
	
	
	// draw every entity in the manager
	/*manager.when('ready', function(e) {
		manager.list[0].video.play();
		manager.draw();
		console.log('ready!!!');
	});*/
	
	console.log('manager = ', manager);

		</script>

	</body>
</html>
