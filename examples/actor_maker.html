<!DOCTYPE html>
<html>
	<head>
	    <script src="lib/box2d.min.js"></script>
		<script src="../build/yespix.js"></script>
		<style>

body {
	background-color: #fff;
}


.start {
	-moz-box-shadow:inset 0px 1px 0px 0px #f29c93;
	-webkit-box-shadow:inset 0px 1px 0px 0px #f29c93;
	box-shadow:inset 0px 1px 0px 0px #f29c93;
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #fe1a00), color-stop(1, #ce0100));
	background:-moz-linear-gradient(top, #fe1a00 5%, #ce0100 100%);
	background:-webkit-linear-gradient(top, #fe1a00 5%, #ce0100 100%);
	background:-o-linear-gradient(top, #fe1a00 5%, #ce0100 100%);
	background:-ms-linear-gradient(top, #fe1a00 5%, #ce0100 100%);
	background:linear-gradient(to bottom, #fe1a00 5%, #ce0100 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fe1a00', endColorstr='#ce0100',GradientType=0);
	background-color:#fe1a00;
	-moz-border-radius:6px;
	-webkit-border-radius:6px;
	border-radius:6px;
	border:1px solid #d83526;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #b23e35;
}
.start:hover {
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #ce0100), color-stop(1, #fe1a00));
	background:-moz-linear-gradient(top, #ce0100 5%, #fe1a00 100%);
	background:-webkit-linear-gradient(top, #ce0100 5%, #fe1a00 100%);
	background:-o-linear-gradient(top, #ce0100 5%, #fe1a00 100%);
	background:-ms-linear-gradient(top, #ce0100 5%, #fe1a00 100%);
	background:linear-gradient(to bottom, #ce0100 5%, #fe1a00 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ce0100', endColorstr='#fe1a00',GradientType=0);
	background-color:#ce0100;
}
.start:active {
	position:relative;
	top:1px;
}


.input-number {
	-moz-box-shadow:inset 0px 0px 7px 0px #b0b0b0;
	-webkit-box-shadow:inset 0px 0px 7px 0px #b0b0b0;
	box-shadow:inset 0px 0px 7px 0px #b0b0b0;
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #ffffff), color-stop(1, #f6f6f6));
	background:-moz-linear-gradient(top, #ffffff 5%, #f6f6f6 100%);
	background:-webkit-linear-gradient(top, #ffffff 5%, #f6f6f6 100%);
	background:-o-linear-gradient(top, #ffffff 5%, #f6f6f6 100%);
	background:-ms-linear-gradient(top, #ffffff 5%, #f6f6f6 100%);
	background:linear-gradient(to bottom, #ffffff 5%, #f6f6f6 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#f6f6f6',GradientType=0);
	background-color:#ffffff;
	-moz-border-radius:3px;
	-webkit-border-radius:3px;
	border-radius:3px;
	border:1px solid #696969;
	display:inline-block;
	color:#2b2b2b;
	font-family:Arial;
	font-size:14px;
	padding:2px 4px;
	text-decoration:none;
	text-shadow:0px 1px 0px #ffffff;
	width: 80px;
	float: right;
	text-align: right;
}

.button-small {
	-moz-box-shadow:inset 0px -2px 3px 0px #23395e;
	-webkit-box-shadow:inset 0px -2px 3px 0px #23395e;
	box-shadow:inset 0px -2px 3px 0px #23395e;
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #2e466e), color-stop(1, #415989));
	background:-moz-linear-gradient(top, #2e466e 5%, #415989 100%);
	background:-webkit-linear-gradient(top, #2e466e 5%, #415989 100%);
	background:-o-linear-gradient(top, #2e466e 5%, #415989 100%);
	background:-ms-linear-gradient(top, #2e466e 5%, #415989 100%);
	background:linear-gradient(to bottom, #2e466e 5%, #415989 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#2e466e', endColorstr='#415989',GradientType=0);
	background-color:#2e466e;
	-moz-border-radius:3px;
	-webkit-border-radius:3px;
	border-radius:3px;
	border:1px solid #1f2f47;
	display:inline-block;
	color:#ffffff;
	font-family:Arial;
	font-size:11px;
	font-weight:bold;
	padding:2px 4px;
	text-decoration:none;
	float: right;
}
.button-small:hover {
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #415989), color-stop(1, #2e466e));
	background:-moz-linear-gradient(top, #415989 5%, #2e466e 100%);
	background:-webkit-linear-gradient(top, #415989 5%, #2e466e 100%);
	background:-o-linear-gradient(top, #415989 5%, #2e466e 100%);
	background:-ms-linear-gradient(top, #415989 5%, #2e466e 100%);
	background:linear-gradient(to bottom, #415989 5%, #2e466e 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#415989', endColorstr='#2e466e',GradientType=0);
	background-color:#415989;
}
.button-small:active {
	position:relative;
	top:1px;
}

.panel {
	-moz-box-shadow:inset 0px 1px 0px 0px #54a3f7;
	-webkit-box-shadow:inset 0px 1px 0px 0px #54a3f7;
	box-shadow:inset 0px 1px 0px 0px #54a3f7;
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #007dc1), color-stop(1, #0061a7));
	background:-moz-linear-gradient(top, #007dc1 5%, #0061a7 100%);
	background:-webkit-linear-gradient(top, #007dc1 5%, #0061a7 100%);
	background:-o-linear-gradient(top, #007dc1 5%, #0061a7 100%);
	background:-ms-linear-gradient(top, #007dc1 5%, #0061a7 100%);
	background:linear-gradient(to bottom, #007dc1 5%, #0061a7 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#007dc1', endColorstr='#0061a7',GradientType=0);
	background-color:#007dc1;
	-moz-border-radius:6px;
	-webkit-border-radius:6px;
	border-radius:6px;
	border:1px solid #124d77;
	display:inline-block;
	color:#ffffff;
	font-family:Arial;
	font-size:13px;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #154682;
}

.varName {
	float: left;
}

.line {
	clear: both;
}

		</style>
	</head>
	<body>
		<script type="text/javascript">
	

	function add(type, name, n, update) {
		var id = type+'-'+name;
		var value = parseInt(document.getElementById(id).value * 1000);
		value += parseInt(n * 1000);
		value = (value / 1000).toFixed(4);
		document.getElementById(id).value = value;
	}



	function createVar(type, name, value, step) {

		var str = '<div class="line">';
		str += '<div class="varName">'+name+':</div> ';
		str += '<input type="button" value="-" class="button-small" onclick="add(\''+type+'\', \''+name+'\', -'+step+');" />';
		str += '<input type="button" value="+" class="button-small" onclick="add(\''+type+'\', \''+name+'\', '+step+');" />';
		str += '<input type="text" class="input-number" id="'+type+'-'+name+'" value="'+value+'">';
		str += '</div>';

		str += '<'+'script> add(\''+type+'\', \''+name+'\', 0); </'+'script>';

		document.write(str);

		return str;
	}


	function getCollision() {
		var object = {};
		var type = 'collision';
		var names = new Array('offsetX', 'offsetY', 'width', 'height', 'linearDamping', 'restitution', 'density');
		for (var t=0; t<names.length; t++) {
			var id = type + '-' + names[t];
			var value = parseFloat(document.getElementById(id).value);
			object[names[t]] = value;
		}
		return object;
	}

	function getActor() {
		var object = {};
		var type = 'actor';
		var names = new Array('speedWalk', 'speedJump', 'speedUp', 'speedTimeJump', 'speedAir', 'speedMax', 'frictionAir', 'frictionGround', 'frictionIdle');
		for (var t=0; t<names.length; t++) {
			var id = type + '-' + names[t];
			var value = parseFloat(document.getElementById(id).value);
			object[names[t]] = value;
		}
		return object;
	}


	function getWorld() {
		var object = {};
		var type = 'world';
		var names = new Array('gravity', 'scale', 'friction', 'linearDamping', 'restitution', 'density');
		for (var t=0; t<names.length; t++) {
			var id = type + '-' + names[t];
			var value = parseFloat(document.getElementById(id).value);
			object[names[t]] = value;
		}
		return object;
	}




	function start() {
		
		manager.reset(manager.canvas);

		// create physics
		worldOptions = getWorld();
	    manager.setPhysics(new yespix.class.physicsBox2d(worldOptions));

	    // get actor options
		actorOptions = getActor();

		// get collision options
		collisionOptions = getCollision();
		collisionOptions.physics = manager.physics;
		collisionOptions.fixedRotation = true;
		collisionOptions.isBullet = true;

		// create player
		var player = new yespix.entity.gfx({position: {x: 50, y: 200}});
		player.actor = new yespix.class.actor2w(actorOptions, player);
		player.collision = new yespix.class.collision(collisionOptions, player);
		manager.add(player);



	    // ground
	    manager.physics.createRect(0, 400, 640, 10, {type: 'static'});

	    // blocs
	    manager.physics.createRect(400, 350, 100, 50, {type: 'static'});
	    manager.physics.createRect(550, 320, 100, 20, {type: 'static'});
	    manager.physics.createRect(0, 300, 20, 100, {type: 'static'});

	    // moving platform
	    //var platform = manager.physics.createRect(200, 350, 50, 20, {type: 'kinematic'});
		var platform = new yespix.entity.gfx({position: {x: 150, y: 380}});
		platform.actor = new yespix.class.actorPlatform({type: 'linear', to: {y: -200}, speed: 0.5}, platform);
		platform.collision = new yespix.class.collision({type: 'kinematic', width: 50, height: 20, physics: manager.physics}, platform);
		manager.add(platform);


		// add random blocs
		for (var t=0; t<5; t++) {
			object = new yespix.entity.gfx(
				{
					aspect: {
						width: yespix.randInt(10, 60),
						height: yespix.randInt(10, 60)
					},
					position: {
						x: yespix.randInt(150, 300),
						y: yespix.randInt(0, -1500)
					}
				});
			object.collision = new yespix.class.collision({ physics: manager.physics }, object);
			manager.add(object);
		}

		// load entities
		manager.load();

		// start loop
		loop.start();
		
	}

	function formatObject(object) {
		var str = '{';
		var count = 0;
		for (var name in object) {
			if (count>0) {
				str += ',';
			}
			count++;
			str += String.fromCharCode(13);
			str += '	'+name + ': '+object[name];
		}
		if (count>0) {
			str += String.fromCharCode(13);
		}
		str += '}';

		return str;
	};

	function code() {
		var str = '';
		var collisionOptions = getCollision();
		collisionOptions.fixedRotation = true;
		collisionOptions.isBullet = true;

		var actorOptions = getActor();
		var worldOptions = getWorld();

		str += String.fromCharCode(13);
		str += 'yespix();' + String.fromCharCode(13);
		str += String.fromCharCode(13);
		str += '///////////////////////////////////////////////////////////////' + String.fromCharCode(13);
		str += String.fromCharCode(13);
		str += 'var worldOptions = ' + formatObject(worldOptions) + ';' + String.fromCharCode(13);
		str += String.fromCharCode(13);
		str += 'var actorOptions = ' + formatObject(actorOptions) + ';' + String.fromCharCode(13);
		str += String.fromCharCode(13);
		str += 'var collisionOptions = ' + formatObject(collisionOptions) + ';' + String.fromCharCode(13);
		str += String.fromCharCode(13);
		str += '///////////////////////////////////////////////////////////////' + String.fromCharCode(13);
		str += String.fromCharCode(13);
		str += 'var physics = new yespix.class.engineBox2d(worldOptions);' + String.fromCharCode(13);
		str += 'collisionOptions.physics = physics;' + String.fromCharCode(13);
		str += 'var player = new yespix.entity.gfx({});' + String.fromCharCode(13);
		str += 'player.actor = new yespix.class.actor2w(actorOptions, player);' + String.fromCharCode(13);
		str += 'player.collision = new yespix.class.collision(collisionOptions, player);' + String.fromCharCode(13);
		str += String.fromCharCode(13);
		str += 'var manager = new yespix.class.gfxManager(true);' + String.fromCharCode(13);
		str += 'manager.setPhysics(physics);' + String.fromCharCode(13);
		str += 'manager.add(player);' + String.fromCharCode(13);
		str += 'var input = new yespix.class.input();' + String.fromCharCode(13);
		str += 'var loop = new yespix.class.loop(100);' + String.fromCharCode(13);
		str += 'loop.register(' + String.fromCharCode(13);
		str += '	function(loop, time) { ' + String.fromCharCode(13);
        str += '		manager.applyPhysics();' + String.fromCharCode(13);
        str += '		manager.clear();' + String.fromCharCode(13);
		str += '        manager.physics.world.DrawDebugData();' + String.fromCharCode(13);
		str += '	}, ' + String.fromCharCode(13);
		str += '	function(loop, time) { ' + String.fromCharCode(13);
		str += '		manager.physics.world.Step(time/1000, 500, 50);' + String.fromCharCode(13);
		str += '	}' + String.fromCharCode(13);
		str += ').start();' + String.fromCharCode(13);
		str += String.fromCharCode(13);
		str += 'manager.physics.createRect(0, 400, 640, 10, {type: \'static\'});' + String.fromCharCode(13);
		str += String.fromCharCode(13);

		document.getElementById('code').innerHTML = str;
	}


	//////////////////////////////////////////////////////////////////////////////
	
	
		</script>

<canvas width="800" height="500" id="canvas"></canvas>

<div class="line">
	<div class="panel">
		<h2>Actor</h2>
		<script>
		createVar('actor', 'speedWalk', 	 0.40, 0.10);
		createVar('actor', 'speedJump', 	 6.00, 0.10);
		createVar('actor', 'speedUp',   	 0.20, 0.10);
		createVar('actor', 'speedTimeJump',  0.40, 0.10);
		createVar('actor', 'speedAir', 		 0.15, 0.10);
		createVar('actor', 'speedMax',	 	 10.0, 0.10);
		createVar('actor', 'frictionAir', 	 0.10, 0.10);
		createVar('actor', 'frictionGround', 2.00, 0.10);
		createVar('actor', 'frictionIdle', 	 5.00, 0.10);
		</script>
	</div>

	<div class="panel">
		<h2>Collision</h2>
		<script>
		createVar('collision', 'offsetX', 	     0.00, 0.10);
		createVar('collision', 'offsetY', 	     0.00, 0.10);
		createVar('collision', 'width',   	    50.00, 0.10);
		createVar('collision', 'height',       100.00, 0.10);
		createVar('collision', 'linearDamping',  1.00, 0.10);
		createVar('collision', 'restitution', 	 0.00, 0.10);
		createVar('collision', 'density', 	     0.00, 0.10);
		</script>
	</div>

	<div class="panel">
		<h2>World</h2>
		<script>
		createVar('world', 'gravity', 	    20.00, 0.10);
		createVar('world', 'scale',         30.00, 0.10);
		createVar('world', 'friction',       0.10, 0.10);
		createVar('world', 'linearDamping',  0.10, 0.10);
		createVar('world', 'restitution', 	 0.10, 0.10);
		createVar('world', 'density', 	     0.10, 0.10);
		</script>
	</div>
</div>

<div class="line" style="margin-top: 20px;">
	<input type="button" class="start" value="Restart" onclick="start();" style="margin-top: -20px;" />
	<input type="button" class="start" value="Get the code" onclick="code();" style="margin-top: -20px;" />

	<textarea rows="20" cols="100" id="code" style="margin-top: 40px; clear: both;"></textarea>
</div>

<script type="text/javascript">

	var collisionOptions = getCollision();
	var actorOptions = getActor();
	var canvas = document.getElementById('canvas');

	// init yespix
	yespix();

	// create gfx manager
	var manager = new yespix.class.gfxManager(canvas);

    // create input
	var input = new yespix.class.input();

	// create loop
	var loop = new yespix.class.loop(100);

	// register tick and frame functions
	loop.register(
		function(loop, time) { 
            manager.applyPhysics(time); // apply position from physics engine
            //platform
	    	//manager.physics.setLinearVelocity(platform, manager.physics.vec2(0, -0.5));
	    	//manager.physics.setLinearVelocity(platform, manager.physics.vec2(0, -0.5));

            manager.clear(); // clear canvas
            manager.physics.world.DrawDebugData(); // draw debug
            // manager.physics.world.ClearForces();
		}, 
		function(loop, time) { 
			manager.physics.world.Step(time/1000, 500, 50);
		}
	);

</script>
	</body>
</html>
