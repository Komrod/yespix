<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="../engine/yespix.js"></script>
</head>
<body>
<script type="text/javascript">

	
	var yp = yespix({canvas: {width: 600, height: 600}, fps: 50});
	
	yp.define('simactor', 'circle, move, collision',
	{
		circleRadius: 5,
		lineWidth: 1.0,
		lineColor: '#101010',
		fillColor: '#6B9F69',
		colWidth: 10,
		colHeight: 10,
		moveFriction: 0,

		maxSpeed: 1,
		nextThink: 0,

		init: function()
		{
			this.think();

			yespix.on('enterFrame', this.enterFrame, this, yespix);
		},

		enterFrame: function()
		{
			if (this.nextThink < new Date().getTime()) this.think();
		},

		think: function()
		{
		}
	});
	
	yp.define('zombie', 'simactor',
	{
		lineColor: '#101010',
		fillColor: '#6B9F69',

		maxSpeed: 0.5,
		follow: null,

		think: function()
		{
			var humans = yespix.find('.human').array();
			if (humans.length ==0)
			{
				var r = yespix.randInt(0,1);
				if (r == 1) this.z_stroll();
				else this.z_stop();
			}
			if (this.nextThink < new Date().getTime()) this.nextThink = new Date().getTime() + yespix.randFloat(1,3) * 1000;
		},
		
		z_follow: function(human)
		{
			this.nextThink = new Date().getTime() + yespix.randFloat(1,3) * 1000;
		},

		z_stroll: function()
		{
			if (this.speedX == 0 && this.speedY == 0)
			{
				this.speedX = yespix.randFloat(-this.maxSpeed, this.maxSpeed);
				this.speedY = yespix.randFloat(-this.maxSpeed, this.maxSpeed);
			} else
			{
				var r = yespix.randInt(0,3);
				if (r < 3)
				{
					this.speedX += yespix.randFloat(-this.maxSpeed / 2, this.maxSpeed / 2);
					this.speedY += yespix.randFloat(-this.maxSpeed / 2, this.maxSpeed / 2);
				} else
				{
					this.z_stop();
				}
			}
			if (this.speedX > this.maxSpeed) this.speedX = this.maxSpeed;
			else if (this.speedX < -this.maxSpeed) this.speedX = -this.maxSpeed;
			if (this.speedY > this.maxSpeed) this.speedY = this.maxSpeed;
			else if (this.speedY < -this.maxSpeed) this.speedY = -this.maxSpeed;
		},

		z_stop: function()
		{
			this.speedX = 0;
			this.speedY = 0;
		}

	});
	

	for (var t=0; t<150; t++)
	{
		yespix.spawn('zombie', {
			x: yespix.randFloat(0,590),
			y: yespix.randFloat(0,590)
		});
	}

	//yp.find().prop({alpha: 0.1});


</script>

</body>
</html>
