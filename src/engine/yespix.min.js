!function(undefined){function yespix(a){return this instanceof yespix?(this.init(a),void this.trigger("ready")):new yespix(a)}yespix.fn=yespix.prototype,Bunch=function(a){return this instanceof Bunch?void this.__bunch_init.apply(this,arguments):new Bunch(a)},Bunch.prototype=[],Bunch.prototype.unique=function(){for(var a=0;a<this.length;a++)for(var b=a+1;b<this.length;b++)this[a]===this[b]&&this.splice(b--,1)},Bunch.prototype.__bunch_init=function(a){if(a&&a.length>0){for(var b=0;b<a.length;b++)this.push(a[b]);this.unique()}},Bunch.prototype.__bunch_each=function(){},Bunch.prototype.array=function(){for(var a=[],b=0;b<this.length;b++)a.push(this[b]);return a},yespix.fn.attach=function(a,b){if(this.isArray(b)){for(var c=0;c<b.length;c++)this.attach(a,b[c]);return this}return b._parent==a?null:(a._children?a._children.push(b):a._children=[b],b._parent&&this.detach(b._parent,b),b._parent=a,this)},yespix.fn.detach=function(a,b){var c;if(!b){if(a._children){for(c=0;c<a._children.length;c++)a._children[c]._parent=null;a._children=null}return this}if(this.isArray(b)){for(c=0;c<b.length;c++)this.detach(a,b[c]);return this}if(b._parent!=a)return null;for(b._parent=null,c=0;c<a._children.length;c++)if(a._children[c]==b){a._children.splice(c,1);break}return this},yespix.fn.collisionClear=function(){this.data.collisionMap=[]},yespix.fn.collisionCellSize=function(a){1>a&&(a=32),this.collisionSize=a,this.collisionClear()},yespix.fn.collisionCell=function(a,b,c){if("canvas"==c)var a=Math.floor(a/this.collisionSize),b=Math.floor(b/this.collisionSize);var d=this.data.collisionMap[a];return d||(d=this.data.collisionMap[a]=[]),d[b]||(d[b]=[]),d[b]},yespix.fn.collisionOccupy=function(a){var b=a.collisionBox();if(!(b.width<=0||b.height<=0))for(var c=minCellX=Math.floor(b.x/this.collisionSize),d=minCellY=Math.floor(b.y/this.collisionSize),e=Math.floor((b.x+b.width)/this.collisionSize),f=Math.floor((b.y+b.height)/this.collisionSize);e>=c;){for(d=minCellY;f>=d;)this.collisionAdd(a,c,d),d++;c++}},yespix.fn.collisionAdd=function(a,b,c,d){if("canvas"==d)var b=Math.floor(b/this.collisionSize),c=Math.floor(c/this.collisionSize);var e=this.data.collisionMap[b];return e?(e[c]||(e[c]=[],this.key(" ")&&console.log("collisionAdd :: new column, final entity count 1")),e[c].push(a),this.key(" ")&&console.log("collisionAdd :: before unique count "+e[c].length),this.unique(e[c]),this.key(" ")&&console.log("collisionAdd :: final entity count "+e[c].length),!0):(e=this.data.collisionMap[b]=[],e[c]=[a],!0)},yespix.fn.collisionCheck=function(a,b){var c=a.collisionBox(),d=b.collisionBox();return c.x+c.width-1<d.x?!1:c.x+1>d.x+d.width?!1:c.y+c.height-1<d.y?!1:c.y+1>d.y+d.height?!1:!0},yespix.fn.collisionTouch=function(a,b,c){this.isUndefined(c)&&(c=1);var d=a.collisionBox(),e=b.collisionBox();return this.dump(d,"box1"),this.dump(e,"box2"),d.x+d.width>e.x-c&&d.x+d.width<e.x+c?!0:d.x>e.x+e.width-c&&d.x<e.x+e.width+c?!0:d.y+d.height>e.y-c&&d.y+d.height<e.y+c?!0:d.y>e.y+e.height-c&&d.y<e.y+e.height+c?!0:!1},yespix.fn.collisionInside=function(a,b){var c=a.collisionBox(),d=b.collisionBox();return d.x<=c.x&&d.x+d.width>=c.x+c.width&&d.y<=c.y&&d.y+d.height>=c.y+c.height?!0:!1},yespix.fn.collision=function(a){var b=[],c=a.collisionBox();if(!(c.width<=0||c.height<=0))for(var d=minCellX=Math.floor(c.x/this.collisionSize),e=minCellY=Math.floor(c.y/this.collisionSize),f=Math.floor((c.x+c.width)/this.collisionSize),g=Math.floor((c.y+c.height)/this.collisionSize);f>=d;){for(e=minCellY;g>=e;){for(var h=this.collisionCell(d,e),i=0;i<h.length;i++)h[i]===a||this.inArray(b,h[i])||a.collisionWith(h[i])&&this.collisionCheck(a,h[i])&&a.trigger("collide",{entity:h[i]}),b.push(h[i]);e++}d++}},yespix.fn.entityRootClassname="",yespix.fn.entityClasses={},yespix.fn.entityInstances={},yespix.fn.entityNextId=1,yespix.fn.entityNextClassId=1,yespix.fn.find=function(a,b){if(this.isUndefined(a)){var c=this.bunch(this.entityInstances[""]);return b&&this.each(c,b),c}var d={};if(this.isString(a)){if(""===a){var c=this.bunch(this.entityInstances[""]);return b&&this.each(c,b),c}d=this.selectorInit(a)}else{if(this.isInt(a))return this.entityInstances[+a]?this.bunch([this.entityInstances[+a]]):this.bunch();if(this.isObject(a)){if(0==this.pLength(a)){var c=this.bunch(this.entityInstances[""]);return b&&this.each(c,b),c}d=a}}if(this.isArray(d)){var c=[];for(var e in d)c=c.concat(this.find(d[e]).array());return this.bunch(c)}var f=this.pLength(d),c=this.bunch(),g=[];if(d._class&&""!=d._class){if(!this.entityInstances["."+d._class])return this.bunch();if(g=this.entityInstances["."+d._class],1==f)return this.bunch(g)}else if(d._ancestors&&this.isString(d._ancestors)&&""!=d._ancestors){if(!this.entityInstances["/"+d._ancestors])return this.bunch();if(g=this.entityInstances["/"+d._ancestors],1==f)return this.bunch(g)}else g=this.entityInstances[""];for(var h=0;h<g.length;h++){var i=0;for(var e in d)g[h]!==undefined&&g[h][e]!==undefined&&this.selectorCompare(g[h][e],d[e])&&i++,i>=f&&c.push(g[h])}return b&&this.each(c,b),c},yespix.fn.selectorInit=function(a){if(-1!=a.indexOf(",")){var b=[],c=a.split(","),b=[];for(var d in c)b.push(this.selectorInit(c[d]));return b}var e={};if(-1!=a.indexOf(" ")){var f=a.split(" ");for(var d in f)""!=f&&(e[this.selectorType(f[d])]?console.warn('entity.selectorInit: ambiguous selector item: "'+f[d]+'" defined twice in "'+a+'"'):e[this.selectorType(f[d])]=this.selectorValue(f[d]))}else e[this.selectorType(a)]=this.selectorValue(a);return e},yespix.fn.selectorCompare=function(a,b){return this.isString(b)?this.isArray(a)?this.inArray(a,b):a===b:this.isArray(b)?this.isString(a)?this.inArray(b,a):a===b:this.isRegexp(b)&&this.isString(a)?b.test(a):a===b},yespix.fn.selectorType=function(a){return"."==a[0]?"_class":"#"==a[0]?"_id":"/"==a[0]?"_ancestors":"name"},yespix.fn.selectorValue=function(a){return"."==a[0]?a.substr(1,a.length):"#"==a[0]?+a.substr(1,a.length):"/"==a[0]?a.substr(1,a.length):a},yespix.fn.bunch=function(a){return a&&0!=a.length?new Bunch(a):new Bunch},yespix.fn.mixin=function(a,b){for(fn in b)a[fn]=b[fn],this.isFunction(a[fn])&&(Bunch.prototype[fn]=function(a,b){return function(){var c=[].slice.call(arguments);return b.each(this.array(),a,c),this}}(fn,this))},yespix.fn.ancestors=function(a){if(this.entityClasses[a]){for(var b=[],c=0;c<this.entityClasses[a].ancestors.length;c++){var d=this.entityClasses[a].ancestors[c];b=b.concat(this.ancestors(d))}return b.push(a),b}return[]},yespix.fn.define=function(a,b,c){if(this.entityClasses[a])return void console.warn('define :: entity class name "'+a+'" already exists');"string"!=typeof b&&(c=b,b=this.entityRootClassname),"object"!=typeof c&&(c={}),""==b&&(b=this.entityRootClassname),b=b.split(" ").join(",").split(","),this.entityClasses[a]={ancestors:[],classname:a,properties:c};for(var d=0;d<b.length;d++)""!=b[d]&&(this.entityClasses[b[d]]?b[d]==a?console.warn("define :: entity class cannot add itself to ancestors, skipping"):this.entityClasses[a].ancestors=this.entityClasses[a].ancestors.concat(this.ancestors(b[d])):console.warn('define :: cannot find the entity class name "'+b[d]+'", skipping'));return this.entityClasses[a].ancestors=this.unique(this.entityClasses[a].ancestors),this.trigger("define",{"class":this.entityClasses[a]}),this},yespix.fn.spawn=function(a,b){if(b=b===!0?{}:b||{},-1!=a.indexOf(",")){var c=a;a=b.name&&!this.entityClasses[b.name]?b.name:"tempclass"+this.entityNextClassId++,this.define(a,c,b),b={}}if(!this.isDefined(a))return console.warn('spawn :: entity class name "'+a+'" does not exist'),null;for(var d={},e=0;e<this.entityClasses[a].ancestors.length;e++){var f=this.entityClasses[this.entityClasses[a].ancestors[e]];f?this.mixin(d,f.properties):console.warn('spawn :: entity class ancestor "'+this.entityClasses[a].ancestors[e]+'" does not exist for entity class name "'+a+'"')}this.mixin(d,this.entityClasses[a].properties);for(var g in b)d[g]=b[g];if(d._class=a,d._ancestors=this.entityClasses[a].ancestors,d._id=this.entityNextId++,this.instanceAdd(d),this.call(d,"init",[b]),this.isFunction(d.init)&&d.init(b),d._ancestors.length>0)for(e=0;e<d._ancestors.length;e++)this.trigger("spawn:"+d._ancestors[e],{entity:d});return d},yespix.fn.instanceAdd=function(a){if(a._instances&&this.instanceRemove(a),a._instances={},this.isUndefined(this.entityInstances[""])||0==this.entityInstances[""].length?(this.entityInstances[""]=[a],a._instances[""]=0):(this.entityInstances[""].push(a),a._instances[""]=this.entityInstances[""].length-1),this.entityInstances[+a._id]=a,this.isUndefined(this.entityInstances["."+a._class])||0==this.entityInstances["."+a._class].length?(this.entityInstances["."+a._class]=[a],a._instances[a._class]=0):(this.entityInstances["."+a._class].push(a),a._instances[a._class]=this.entityInstances["."+a._class].length-1),a._ancestors.length>0)for(var b=0;b<a._ancestors.length;b++)this.isUndefined(this.entityInstances["/"+a._ancestors[b]])||0==this.entityInstances["/"+a._ancestors[b]].length?(this.entityInstances["/"+a._ancestors[b]]=[a],a._instances[a._ancestors[b]]=0):(console.log("add instance to /"+a._ancestors[b]),this.entityInstances["/"+a._ancestors[b]].push(a),a._instances[a._ancestors[b]]=this.entityInstances["/"+a._ancestors[b]].length-1);this.trigger("spawn",{entity:a}),this.trigger("spawn:"+a._class,{entity:a})},yespix.fn.instanceRemove=function(a){if(this.entityInstances[""]&&this.entityInstances[""].splice(a._instances[""],1),delete this.entityInstances[+a._id],this.entityInstances["."+a._class]&&this.entityInstances["."+a._class].splice(a._instances[a._class],1),a._ancestors.length>0)for(var b=0;b<a._ancestors.length;b++)this.entityInstances["/"+a._ancestors[b]]&&this.entityInstances["/"+a._ancestors[b]].splice(a._instances[a._ancestors[b]],1);this.trigger("remove",{entity:a}),this.trigger("remove:"+a._class,{entity:a})},yespix.fn.isDefined=function(a){return!!this.entityClasses[a]},yespix.fn.hasAncestors=function(a,b){if(!this.isDefined(name))return null;this.isString(b)&&(b=[b]);for(var c=0;c<b.length;c++)if(!this.inArray(this.entityClasses[name].ancestors,b[c]))return!1;return!0},yespix.fn.call=function(a,b,c,d){if(!this.isDefined(a._class))return null;if(this.isString(c)?c=c.split(","):c&&!d&&(d=c,c=[]),d=d||[],c=c||[],c.length>0&&!this.hasAncestors(a._class,c))return null;0==c.length&&(c=this.entityClasses[a._class].ancestors);for(var e=[],f=0;f<c.length;f++)if(this.entityClasses[c[f]]&&this.entityClasses[c[f]].properties[b]&&this.isFunction(this.entityClasses[c[f]].properties[b]))e.push({name:c[f],status:"called",result:this.entityClasses[c[f]].properties[b].apply(a,d),error:""});else{var g="";g=this.entityClasses[c[f]]?this.entityClasses[c[f]].properties[b]?this.isFunction(this.entityClasses[c[f]].properties[b])?"Unknown error":'Property "'+b+'" is not a function in ancestor entity "'+c[n]+'"':'Ancestor entity "'+c[f]+'" have no "'+b+'" function':'Ancestor entity "'+c[f]+'" does not seem to be defined',e.push({name:c[f],status:"error",result:null,error:g})}return this.trigger("call",{entity:a,fn:b,ancestors:c,params:d,result:e}),e},yespix.fn.trigger=function(a,b,c){if(!a)return this;if(c=c||this,b=b||{},b.type=a,c._eventList&&c._eventList[a])for(var d=0,e=c._eventList[a].length;e>d;d++){var f=c._eventList[a][d].context||this;c._eventList[a][d].callback.apply(f,[b])}return this},yespix.fn.on=function(a,b,c,d){return a&&b?(c=c||this,d=d||c,d._eventList||(d._eventList={}),d._eventList[a]?d._eventList[a].push({name:a,callback:b,context:c}):d._eventList[a]=[{name:a,callback:b,context:c}],this):null},yespix.fn.off=function(a,b,c){if(!a)return null;if(this.isObject(b)&&(c=b,b=null),c=c||this,!c._eventList||!c._eventList[a])return this;if(!b)return delete c._eventList[a],this;if(c._eventList[a])for(var d=0,e=c._eventList[a].length;e>d;d++)c._eventList[a][d]&&c._eventList[a][d].callback==b&&(delete c._eventList[a][d],c._eventList[a].splice(d,1),d--);return this},yespix.fn.ready=function(a,b){return isReady?a.call(b,{type:"ready"}):on("ready",a,b),this},yespix.fn.load=function(a,b,c){function d(a){var b=j.file;if(a.file=b,b.done)return a.size=b.size,a.totalSize=b.size,a.loaded=b.loaded,void(a.progress=b.progress);b.lengthComputable||a.lengthComputable?(b.lengthComputable=!0,b.loaded<a.loaded&&(b.loaded=a.loaded),b.size<a.totalSize&&(b.size=a.totalSize),b.progress=b.size>0?parseInt(b.loaded/b.size*1e4)/100:100,b.progress>100&&(b.progress=100),b.state=100==b.progress?"loaded":"processing"):(b.state="pending",b.loaded=0,b.progress=0,b.size=0,b.lengthComputable=!1);var d={size:b.size,loaded:b.loaded,progress:b.progress,lengthComputable:b.lengthComputable,state:b.state,url:b.url,file:b,entity:c.entity};if(console.log("file.options.entity: "+b.options.entity),b.options)for(var e=0;e<b.options.length;e++)if(b.options[e]){if(b.options[e].stat.loaded=0,b.options[e].stat.progress=0,b.options[e].stat.size=0,b.options[e].stat.allComplete=!0,b.options[e].stat.allSuccess=!0,b.options[e].stat.errorCount=0,b.options[e].fileList)for(var f=0;f<b.options[e].fileList.length;f++){var g=j.yespix.data.file[b.options[e].fileList[f]];if(g&&g.lengthComputable)b.options[e].stat.loaded+=g.loaded,b.options[e].stat.size+=g.size,g.loaded<g.size&&(b.options[e].stat.allComplete=!1);else{if(!g||"error"!=g.state){b.options[e].stat.allComplete=!1,b.options[e].stat.allSuccess=!1,b.options[e].stat.errorCount++;break}b.options[e].stat.allSuccess=!1}}b.options[e].stat.progress=1==b.options[e].stat.allComplete?100:b.options[e].stat.loaded>0?parseInt(b.options[e].stat.loaded/b.options[e].stat.size*1e4)/100:0}return d}if(!a)return this;this.isString(a)&&(a=[a]),this.isObject(b)&&(c=b,b=function(){}),c=c||{},c.complete=c.complete||b||function(){},c.error=c.error||function(){},c.progress=c.progress||function(){},c.skip=c.skip||function(){},c.success=c.success||function(){},c.once=c.once||!1,c.ordered=c.ordered||!1,c.entity=c.entity||yespix;for(var e,f=a.length,g=0,h={loaded:0,progress:0,size:0,allComplete:!1,allSuccess:!1,errorCount:0};f>g;g++)if(a[g])if(c[a[g]]?(e=c[a[g]],e=e||{},e.complete=e.complete||c.complete||b||function(){},e.error=e.error||c.error||function(){},e.progress=e.progress||c.progress||function(){},e.skip=e.skip||c.skip||function(){},e.success=e.success||c.success||function(){},e.once=e.once||c.once||!1):e=c,e.once&&this.data.file[a[g]])this.options.debug&&console.warn('yespix.load: skip the file "'+a[g]+'"'),e.skip({file:this.data.file[a[g]],url:a[g],type:"skip",entity:c.entity});else{e.isLastFile=g==a.length-1,e.isFirstFile=0==g,e.fileList=a,e.stat=h,this.data.file[a[g]]||(this.data.file[a[g]]={loaded:0,progress:0,size:0,done:!1,lengthComputable:!1,options:[]});var i=this.data.file[a[g]];if(this.data.file[a[g]]&&this.data.file[a[g]].state&&"loaded"!=this.data.file[a[g]].state&&"error"!=this.data.file[a[g]].state)i.options&&0!=i.options.length?i.options.push(e):i.options=[e];else{this.data.file[a[g]]={state:"pending",loaded:0,progress:0,size:0,done:!1,lengthComputable:!1,options:[e],url:a[g]};var j=null;if(window.XMLHttpRequest)j=new XMLHttpRequest;else if(window.ActiveXObject){var k=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(var l in k)try{j=new ActiveXObject(k[l]);break}catch(m){}if(!j)return console.error("yespix.load: the browser does not support XMLHTTPRequest"),null}j.yespix=this,j.url=a[g],j.file=this.data.file[a[g]],j.onreadystatechange=function(a){var b=this.file;a.url=this.url;var c=this.readyState||a.type,e=d(a);if(!b.done&&(/load|loaded|complete/i.test(c)||4==c)){if(e.content=this.responseText,e.url=this.url,e.status=this.status,b.done=!0,this.status>=400){this.yespix.options.debug&&console.error('Could not load the file "'+this.url+'"'),e.state=b.state="error";for(var f=0;f<this.file.options.length;f++)e.stat=this.file.options[f].stat,e.type="error",this.file.options[f].error(e),e.type="complete",this.file.options[f].complete(e);return void(this.file.options=[])}e.state=b.state="loaded";for(var f=0;f<this.file.options.length;f++)e.stat=this.file.options[f].stat,e.type="success",this.file.options[f].success(e),e.type="complete",this.file.options[f].complete(e);this.file.options=[]}},j.addEventListener("progress",function(a){if(!i.done){var b=d(a);b.type="progress";for(var c=0;c<this.file.options.length;c++)b.stat=this.file.options[c].stat,this.file.options[c].progress(b)}},!1),j.open("GET",j.url),j.send("")}}return this},yespix.fn.js=function(fileList,complete,options){var e=null;if(!fileList)return this;if(this.isString(fileList)&&(fileList=[fileList]),this.isObject(complete)&&(options=complete,complete=function(){}),options=options||{},options.complete=options.complete||complete||function(){},options.error=options.error||function(){},options.progress=options.progress||function(){},options.success=options.success||function(){},options.skip=options.skip||function(){},options.once=options.once||!1,options.ordered=options.ordered||!1,success=options.success,options.ordered){var token=0;return options.success=function(e){if(fileList[token]==e.file)for(eval(e.content),success(e),token++;fileList[token]&&this.data.file[fileList[token]]&&"loaded"==this.data.file[fileList[token]].state;)eval(this.data.file[fileList[token]].content),success(this.data.file[fileList[token]].eventComplete),token++;else this.data.file[fileList[token]].eventComplete},this.load(fileList,options)}return options.success=function(e){eval(e.content),success(e)},this.load(fileList,options)},yespix.fn.css=function(fileList,complete,options){var e=null;if(!fileList)return this;this.isString(fileList)&&(fileList=[fileList]),this.isObject(complete)&&(options=complete,complete=function(){}),options=options||{},options.complete=options.complete||complete||function(){},options.error=options.error||function(){},options.progress=options.progress||function(){},options.skip=options.skip||function(){},options.success=options.success||function(){},options.once=!1,options.ordered=options.ordered||!1,options.document=options.document||this.document||document,complete=options.complete;var error=options.error;if(options.ordered){var token=0;return options.complete=function(e){if(fileList[token]==e.url){var s=document.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=e.url,s.async=!0,delete s.crossOrigin,document.getElementsByTagName("head")[0].appendChild(s),"sheet"in s?(sheet="sheet",cssRules="cssRules"):(sheet="styleSheet",cssRules="rules");var interval_id=setInterval(function(){try{if(s[sheet]&&s[sheet][cssRules].length)for(clearInterval(interval_id),clearTimeout(timeout_id),complete(e),token++;fileList[token]&&this.data.file[fileList[token]]&&"loaded"==this.data.file[fileList[token]].state;)eval(this.data.file[fileList[token]].content),complete(this.data.file[fileList[token]].eventComplete),token++}catch(e){}finally{}},20),timeout_id=setTimeout(function(){for(clearInterval(interval_id),clearTimeout(timeout_id),document.getElementsByTagName("head").removeChild(s),error(e),token++;fileList[token]&&this.data.file[fileList[token]]&&"loaded"==this.data.file[fileList[token]].state;)eval(this.data.file[fileList[token]].content),complete(this.data.file[fileList[token]].eventComplete),token++},15e3)}else this.data.file[e.file].eventComplete=e},this.load(fileList,options)}return options.complete=function(a){var b=document.createElement("link");b.type="text/css",b.rel="stylesheet",b.href=a.url,b.async=!0,delete b.crossOrigin,document.getElementsByTagName("head")[0].appendChild(b),"sheet"in b?(sheet="sheet",cssRules="cssRules"):(sheet="styleSheet",cssRules="rules");var c=setInterval(function(){try{b[sheet]&&b[sheet][cssRules].length&&(clearInterval(c),clearTimeout(d),complete(a))}catch(a){}finally{}},10),d=setTimeout(function(){clearInterval(c),clearTimeout(d),error(a)},3e4)},this.load(fileList,options)},yespix.fn.randFloat=function(a,b){return Math.random()*(b-a)+a},yespix.fn.randInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},yespix.fn.clone=function(a){var b=new a.constructor;for(var c in a)a!=a[c]&&(b[c]=a[c]);return b},yespix.fn.unique=function(a){var b,c={},d=a.length,e=[];for(b=0;d>b;b++)c[a[b]]=a[b];for(b in c)e.push(c[b]);return e},yespix.fn.getExtension=function(a){var b=a.split(".").pop();return b==a?"":b},yespix.fn.getFilename=function(a){return a.split("/").pop()},yespix.fn.getDir=function(a){return-1==a.lastIndexOf("/")?"":a.substring(0,this.lastIndexOf("/")+1)},yespix.fn.getNoExtension=function(a){var b=this.getFilename(a);return-1==b.lastIndexOf(".")?b:b.substring(0,b.lastIndexOf("."))},yespix.fn.isInt=function(a){return this.isString(a)?!1:parseFloat(a)!=parseInt(a)||isNaN(a)?!1:!0},yespix.fn.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},yespix.fn.isBoolean=function(a){return"boolean"==typeof a},yespix.fn.isUndefined=function(a){return a===undefined||null===a},yespix.fn.isString=function(a){return"string"==typeof a},yespix.fn.isRegexp=function(a){return a instanceof RegExp},yespix.fn.trim=function(a){return a.replace(/^\s+|\s+$/g,"")},yespix.fn.ltrim=function(a){return a.replace(/^\s+/,"")},yespix.fn.rtrim=function(a){return a.replace(/\s+$/,"")},yespix.fn.xtrim=function(a){return a.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},yespix.fn.isFunction=function(a){return a&&"[object Function]"==={}.toString.call(a)},yespix.fn.isObject=function(a){return this.isString(a)||this.isArray(a)?!1:null!==a&&"object"==typeof a},yespix.fn.pLength=function(a,b){b=b||!0;var c=0;for(var d in a)b?a.hasOwnProperty(d)&&c++:c++;return c},yespix.fn.getType=function(a){return null===a?"null":this.isString(a)?"string":this.isArray(a)?"array":this.isObject(a)?"object":typeof a},yespix.fn.inArray=function(a,b){return-1!=a.indexOf(b)},yespix.fn.each=function(a,b,c){var d;this.isArray(a)||(a=[].slice.call(a));var e=a.length;if(c=c||[],e)if(this.isFunction(b))for(d in a)b.apply(a[d],c);else if(this.isString(b))for(d in a)a[d][b]&&this.isFunction(a[d][b])&&a[d][b].apply(a[d],c);return this},yespix.fn.dump=function(a,b,c,d){b=b||"",c=c||[],d=d||9,console.group(),console.info("Object dump: "+b);var e,f="";for(var g in a)if(!(this.isObject(a)&&c.length>0)||this.inArray(c,g))if(null===a[g])console.log(" - "+g+" : null");else if("undefined"==typeof a[g])console.log(" - "+g+" = undefined");else if("boolean"==typeof a[g])console.log(" - "+g+' = "'+a[g]+'" (boolean)');else if("number"==typeof a[g])console.log(" - "+g+" = "+a[g]+" (number)");else if("function"==typeof a[g])console.log(" - "+g+" (function)");else if(this.isString(a[g]))console.log(" - "+g+' = "'+a[g]+'" (string)');else if(this.isArray(a[g])){if(f="",d)for(e=0;e<a[g].length;e++)if(e>0&&(f+=", "),f+="["+e+"] ",f+=null===a[g][e]?"null":"undefined"==typeof a[g][e]?"undefined":"boolean"==typeof a[g][e]?'"'+a[g][e]+'" (boolean)':"number"==typeof a[g][e]?a[g][e]+" (number)":"string"==typeof a[g][e]?'"'+a[g][e]+'" (string)':"function"==typeof a[g][e]?"function":this.isArray(a[g][e])?"Array ("+a[g][e].length+")":a[g][e],e>d){f+=" ...";break}console.log(""===f?" - "+g+" (array), length "+a[g].length:" - "+g+" (array), length "+a[g].length+", content: "+f)}else if(this.isObject(a[g])){if(f="",e=0,d)for(var h in a[g])if(!(c.length>0)||this.inArray(c,h)){if(e>0&&(f+=", "),f+="["+e+"] "+h+": ",f+=null===a[g][h]?"null":"undefined"==typeof a[g][h]?"undefined":"boolean"==typeof a[g][h]?'"'+a[g][h]+'" (boolean)':"number"==typeof a[g][h]?a[g][h]+" (number)":"string"==typeof a[g][h]?'"'+a[g][h]+'" (string)':"function"==typeof a[g][h]?"function":this.isArray(a[g][h])?"Array ("+a[g][h].length+")":a[g][h],e>d){f+=" ...";break}e++}console.log(""===f?" - "+g+" (object), length "+this.pLength(a[g]):" - "+g+" (object), length "+this.pLength(a[g])+", content: "+f)}else console.log(" - "+g+' : "'+a[g]+'" ('+typeof a[g]+")");console.groupEnd()},yespix.fn.init=function(a){function b(a){a.canvas&&e.spawn("canvas",a.canvas),a.fps&&e.setFps(a.fps),this.collisionSize=a.collisionSize,e.isArray(e.entityInstances["/gfx"])?(this.drawEntities=e.entityInstances["/gfx"],this.drawEntities.sort(compare)):this.drawEntities=[],e.on("spawn",function(){this.drawEntitiesChange=!0}),e.on("remove",function(){this.drawEntitiesChange=!0}),e.on("draw",function(){function a(a,b){return a.z>b.z?1:a.z===b.z&&a.zGlobal>b.zGlobal?1:-1}if(e.drawEntitiesChange?(e.drawEntities=e.entityInstances["/gfx"],e.drawEntities&&(e.drawEntities=e.drawEntities.sort(a)),e.drawEntitiesChange=!1):e.drawEntitiesSort&&(e.drawEntities=e.drawEntities.sort(a),e.drawEntitiesSort=!1),e.drawEntities)for(var b=0;b<e.drawEntities.length;b++)e.drawEntities[b]&&e.drawEntities[b].draw&&e.drawEntities[b].draw()}),a.init(),e.trigger("ready")}this.isReady=!1,this.drawEntities=[],this.drawEntitiesChange=!1,this.collisionSize=64,this.on("ready",function(){this.isReady=!0,this.timerStart()}),this.version="0.13";var c=[];this.data={collisionMap:{},file:{},support:{types:{audio:!0,video:!0},extensions:{".3gp":"audio/3gpp",".ac3":"audio/wav",".avi":"video/avi",".kar":"audio/midi",".mid":"audio/midi",".m4a":"audio/x-m4a",".mov":"video/quicktime",".mp3":"audio/mpeg",".mp4":"video/mp4",".mpa":"audio/mpeg",".mpg":"video/mpeg",".webm":"video/webm"},audio:{},video:{},elements:{}},browser:{infos:{name:null,version:null,os:null,mobile:null,initiated:!1},browserList:[{subString:"Chrome",identity:"Chrome"},{subString:"Firefox",identity:"Firefox"},{subString:"Apple",identity:"Safari",version:"Version"},{subString:"MSIE",identity:"IE",version:"MSIE"},{subString:"Opera",identity:"Opera",version:"Version"},{subString:"OmniWeb",identity:"OmniWeb",version:"OmniWeb/"},{subString:"iCab",identity:"iCab"},{subString:"KDE",identity:"Konqueror"},{subString:"Camino",identity:"Camino"},{subString:"Netscape",identity:"Netscape"},{subString:"Gecko",identity:"Mozilla",version:"rv"},{subString:"Mozilla",identity:"Netscape",version:"Mozilla"}],osList:[{subString:"Win",identity:"Windows"},{subString:"Mac",identity:"Mac"},{subString:"iPhone",identity:"iPhone/iPod"},{subString:"Linux",identity:"Linux"}]},key:{pressed:{},up:{},down:{},hold:{},special:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,leftWindowKey:91,rightWindowKey:92,selectKey:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numLock:144,scrollLock:145}}},a=a||{},a.namespace=a.namespace||"yespix",a.dir_resources=a.dir_resources||"resources/",a.dir_engine=a.dir_engine||"yespix/",a.dir_modules=a.dir_modules||"yespix/modules/",a.modules=this.unique(c.concat(a.modules||[])),a.ready=a.ready||function(){},a.init=a.init||function(){},a.collisionSize=a.collisionSize||64,this.on("ready",a.ready),this.options=a,this.document=a.document||document,this.window=a.window||window,initEntities(this);for(var d=0;d<a.modules.length;d++)/^http(s)?\:\/\//i.test(a.modules[d])||(a.modules[d]=a.dir_modules+a.modules[d],/\.js$/i.test(a.modules[d])||(a.modules[d]=a.modules[d]+".js"));this.options=a,this.window[a.namespace]=this;var e=this;return 0===a.modules.length?(b(a),this):(this.addjs(a.modules,{complete:function(){b(a)},orderedExec:!0}),this)},yespix.fn.key=function(a,b){var c;if(b=b||"hold",this.isString(a)){if(-1!=a.indexOf("|")&&"\\"!=a.charAt(a.indexOf("|")-1)&&a.length>1){var d=a.split("|",2);for(c=0;c<d.length;c++)if(this.key(d[c],b))return!0;return!1}return-1!=a.indexOf("-")&&"\\"!=a.charAt(a.indexOf("-")-1)&&a.length>1?this.key(a.split("-",2),b):a.length>1?this.specialKey(a,b):("pressed"!=b&&(a=a.toUpperCase()),"hold"==b&&this.data.key.up[a.charCodeAt(0)]?!0:!!this.data.key[b][a.charCodeAt(0)])}if(this.isArray(a)){for(c=0;c<a.length;c++)if(!this.key(a[c],b))return!1;return!0}return this.isInt(a)?"hold"==b&&this.data.key.up[a]?!0:!!this.data.key[b][a]:!1},yespix.fn.isKey=function(a,b){return b.length>1?this.data.key.special[b.toLowerCase()]==a:b.charCodeAt(0)==a||b.toUpperCase().charCodeAt(0)==a||b.toLowerCase().charCodeAt(0)==a},yespix.fn.specialKey=function(a,b){return b=b||"hold","hold"==b&&this.data.key.up[this.data.key.special[a.toLowerCase()]]?!0:!!this.data.key[b][this.data.key.special[a.toLowerCase()]]},yespix.fn.listen=function(a,b,c){var d;if(this.isArray(b)){for(d=0;d<b.length;d++)this.listen(a,b[d],c);return!0}if(this.isArray(a)){for(d=0;d<a.length;d++)this.listen(a[d],b,c);return!0}var e=a[b];c=c||this.listenTrigger,Object.defineProperty?(a["__var_callback_"+b]=c,Object.defineProperty(a,b,{get:function(){return a["__var_new_"+b]},set:function(c){a["__var_old_"+b]=a["__var_new_"+b],a["__var_new_"+b]=c,a["__var_callback_"+b].call(a,a,{target:a,name:b,oldValue:a["__var_old_"+b],newValue:c})}})):"__defineSetter__"in a&&"__defineSetter__"in a?(a._changedCallback=c,a.__defineGetter__(b,function(){return a["__var_new_"+b]}),a.__defineSetter__(b,function(c){a["__var_old_"+b]=a["__var_new_"+b],a["__var_new_"+b]=c,a["__var_callback_"+b].call(a,a,{target:a,name:b,oldValue:a["__var_old_"+b],newValue:c})})):(a["__var_old_"+b]=e,a["__var_new_"+b]=e,a["__var_callback_"+b]=c,this.on("enterFrame",function(){this[b]!=this["__var_new_"+b]&&(this["__var_old_"+b]=this["__var_new_"+b],this["__var_new_"+b]=this[b],this["__var_callback_"+b].call(this,this,{target:this,name:b,oldValue:a["__var_old_"+b],newValue:a["__var_new_"+b]}))},a,this)),a[b]=e},yespix.fn.listenTrigger=function(a,b){a._changed=!0,a._changedList||(a._changedList={}),a._changedList[b.name]=!0,a.trigger("change:"+b.name,b)},document.onkeydown=function(a){a=a||window.event,a.code=a.keyCode?a.keyCode:a.which?a.which:a.charCode,yespix.data.key.pressed[parseInt(a.code)]=!0,yespix.data.key.hold[parseInt(a.code)]=!0,a.ctrlKey?yespix.data.key.down[yespix.data.key.special.ctrl]=!0:yespix.data.key.hold[yespix.data.key.special.ctrl]=!1,a.altKey?yespix.data.key.down[yespix.data.key.special.alt]=!0:yespix.data.key.hold[yespix.data.key.special.alt]=!1,a.shiftKey?yespix.data.key.down[yespix.data.key.special.shift]=!0:yespix.data.key.hold[yespix.data.key.special.shift]=!1,yespix.trigger(a.type,a),console.log("trigger "+a.type)},document.onkeyup=function(a){a=a||window.event,a.code=a.keyCode?a.keyCode:a.which?a.which:a.charCode,yespix.data.key.up[parseInt(a.code)]=!0,yespix.data.key.hold[parseInt(a.code)]=!1,a.ctrlKey?yespix.data.key.pressed[yespix.data.key.special.ctrl]=!0:yespix.data.key.hold[yespix.data.key.special.ctrl]=!1,a.altKey?yespix.data.key.pressed[yespix.data.key.special.alt]=!0:yespix.data.key.hold[yespix.data.key.special.alt]=!1,a.shiftKey?yespix.data.key.pressed[yespix.data.key.special.shift]=!0:yespix.data.key.hold[yespix.data.key.special.shift]=!1,yespix.trigger(a.type,a)},document.onkeypress=function(a){a=a||window.event,a.code=a.keyCode?a.keyCode:a.which?a.which:a.charCode,yespix.data.key.pressed[parseInt(a.code)]=!0,yespix.trigger(a.type,a)},document.onblur=function(a){yespix.data.key.pressed={},yespix.data.key.hold={},yespix.data.key.down={},yespix.data.key.up={},yespix.trigger(a.type,a)},yespix.on("exitFrame",function(){this.data.key.pressed={},this.data.key.up={},this.data.key.down={}}),yespix.fn.support=function(a){if(!a)return null;var b=a.split("/");if(1==b.length){if(this.data.support.types[a])return this.data.support.elements[a]||(this.data.support.elements[a]=document.createElement(a)),!!this.data.support.elements[a].canPlayType;if(!this.data.support.extensions[a])return null;a=this.data.support.extensions[a],b=a.split("/")}if(this.data.support[b[0]]!==undefined&&this.data.support[b[0]][b[1]]!==undefined)return this.data.support[b[0]][b[1]];this.data.support.elements[b[0]]===undefined&&(this.data.support.elements[b[0]]=document.createElement(b[0]),this.data.support.elements[b[0]]===!1&&(this.data.support.elements[b[0]]=!1));var c=this.data.support.elements[b[0]];if(!c||c.canPlayType===!1)return!1;var d=c.canPlayType(a);return this.data.support[b[0]][b[1]]="no"==d.toLowerCase()||""===d?!1:!0,this.data.support[b[0]][b[1]]
},yespix.fn.isMobile=function(){return this.data.browser.initiated||this.browser(),this.data.browser.mobile},yespix.fn.browser=function(a){function b(a){for(var b=f.data.browser.browserList,c=0;c<b.length;c++)if(-1!=a.indexOf(b[c].subString))return f.data.browser.found=b[c],b[c].identity}function c(a){for(var b=f.data.browser.osList,c=0;c<b.length;c++)if(-1!=a.indexOf(b[c].subString))return f.data.browser.found=b[c],b[c].identity}function d(a){if(f.data.browser.found){var b=f.data.browser.found.version||f.data.browser.infos.name,c=a.indexOf(b);if(-1!=c)return a.substring(c+b.length+1).split(" ").shift()}}function e(a){return f.data.browser.found?/iPhone|iPod|Android|opera mini|blackberry|palm os|palm| Mobile|hiptop|avantgo|plucker|xiino|blazer|elaine|iris|3g_t|windows ce|opera mobi| smartphone;|;iemobile/i.test(a):void 0}var f=this;if(!f.data.browser.initiated){if(f.data.browser.infos.initiated=!0,f.data.browser.infos.name=b(navigator.userAgent)||b(navigator.vendor)||"Unknown browser",f.data.browser.infos.version=d(navigator.userAgent)||d(navigator.appVersion)||"Unknown version","Unknown version"!=f.data.browser.infos.version){var g=f.data.browser.infos.version;f.data.browser.infos.versionMajor=parseInt(g),f.data.browser.infos.versionMinor=-1!=g.indexOf(".")?g.substring(g.indexOf(".")+1):""}f.data.browser.infos.os=c(navigator.platform)||c(navigator.userAgent)||"Unknown OS",f.data.browser.infos.mobile=e(navigator.userAgent)||e(navigator.platform)||!1}return f.data.browser.initiated=!0,a?f.data.browser.infos[a]:f.data.browser.infos},yespix.fn.frameIndex=0,yespix.fn.frameTime=0,yespix.fn.frameMs=1,yespix.fn.frameRequest=null,yespix.fn.frameRequestId=null,yespix.fn.frameTick=null,yespix.fn.frameTickNext=(new Date).getTime(),yespix.fn.time=+new Date,yespix.fn.fps=60,yespix.fn.timerStart=function(){this.frameRequest||(this.frameRequest=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setInterval(a,1e3/this.fps)}}()),this.frameMs=1e3/this.fps;var a=this;this.frameTick=function(){a.timerStep(),a.frameTick&&a.frameRequest.call(window,a.frameTick)},this.collisionClear(),this.frameTick(),this.trigger("timerStart")},yespix.fn.timerResume=function(){},yespix.fn.timerStop=function(){clearInterval(this.frameRequestId),this.frameTick=null,this.trigger("timerStop")},yespix.fn.timerStep=function(){for(loops=0,this.frameTime=+new Date,this.frameTime-this.frameTickNext>60*this.frameMs&&(this.frameTickNext=this.frameTime-this.frameMs);this.frameTime>this.frameTickNext;){this.frameIndex++,this.trigger("enterFrame",{frameIndex:this.frameIndex}),this.collisionClear();var a=this.find("/collision");a.length>0&&a.collisionOccupy().collision(),this.frameTickNext+=this.frameMs,loops++}loops&&(this.trigger("draw",{frameIndex:this.frameIndex}),this.trigger("exitFrame",{frameIndex:this.frameIndex}))},yespix.fn.currentFps=function(){},yespix.fn.getFps=function(){return this.fps},yespix.fn.setFps=function(a){this.fps=a,this.frameMs=1e3/this.fps},window.yespix=yespix}(),yespix.define("actor","anim move collision",{isAttacking:!1,isFalling:!1,isJumping:!1,isOnGround:!1,actorMove:{},actorSpeed:2,actorSpeedMin:.05,actorDirection:"",actorAnims:{},actorInit:function(){},init:function(){},applyFriction:function(){this.speedX*=1-this.moveFriction,this.speedY*=1-this.moveFriction,this.speedX<this.actorSpeedMin&&this.speedX>-this.actorSpeedMin&&(this.speedX=0),this.speedY<this.actorSpeedMin&&this.speedY>-this.actorSpeedMin&&(this.speedY=0)}}),yespix.define("player2w","actor2w",{actorKeys:{left:"left",right:"right",attack:"x",jump:" "},actorAnims:{idleright:"idleright",idleleft:"idleleft",walkright:"walkright",walkleft:"walkleft",lookup:"lookup",lookdown:"lookdown",jumpleft:"jumpleft",jumpright:"jumpright",airleft:"airleft",airright:"airright",attackleft:"punch1left",attackright:"punch1right"},playerAirFriction:.02,playerGroundFriction:.13,actorOptions:{alwaysRun:!1},init:function(){yespix.on("enterFrame",function(){var a="";this.accelX=this.actorMove.left&&yespix.key(this.actorKeys.left)&&!yespix.key(this.actorKeys.right)?-this.actorSpeed:this.actorMove.right&&yespix.key(this.actorKeys.right)&&!yespix.key(this.actorKeys.left)?this.actorSpeed:0,this.actorMove.attack&&yespix.key(this.actorKeys.attack)&&!this.isAttacking&&(this.isAttacking=!0,a="attack"+this.actorDirection,this.animWait=!1,this.animPlay(this.actorAnims[a]),this.animWait=!0),this.actorMove.jump&&this.isOnGround&&yespix.key(this.actorKeys.jump)?(a="jump"+this.actorDirection,this.animWait=!1,this.animPlay(this.actorAnims[a]),this.animWait=!0,this.accelY=-this.actorSpeedJump,this.animNext="air"+this.actorDirection,this.isJumping=!0,this.jumpTime=(new Date).getTime(),console.log("this.jumpTime = "+this.jumpTime)):this.isJumping?(console.log("jumpTime = "+this.jumpTime+", now = "+(new Date).getTime()+", +400 ? "+(this.jumpTime+400>(new Date).getTime())),this.accelY=this.jumpTime+200>(new Date).getTime()&&yespix.key(this.actorKeys.jump)?-(this.actorSpeedJump/6):0):this.accelY=0,this.speedX>0&&this.speedX>=this.speedY&&this.speedX>=-this.speedY?(this.actorDirection="right",this.isOnGround&&(a="walk")):this.speedX<0&&this.speedX<=this.speedY&&this.speedX<=-this.speedY&&(this.actorDirection="left",this.isOnGround&&(a="walk")),this.isOnGround||(this.speedY>0&&(this.isJumping=!1,this.isFalling=!0),a="air"),""==a?a=this.actorMove["default"]+this.actorDirection:a+=this.actorDirection,this.animNext=this.actorAnims[a],this.animWait||this.isAttacking||this.animPlay(this.actorAnims[a])},this,yespix)},applyFriction:function(){return this.speedX*=1-this.playerGroundFriction,this.speedY*=1-this.playerAirFriction,this.speedX<this.actorSpeedMin&&this.speedX>-this.actorSpeedMin&&(this.speedX=0),this.speedY<this.actorSpeedMin&&this.speedY>-this.actorSpeedMin&&(this.speedY=0),!0}}),yespix.define("actor4w","actor",{actorMove:{idle:!0,up:!0,right:!0,down:!0,left:!0,walk:!0,run:!0,jump:!0,damage:!0,crouch:!0,guard:!0,dead:!0,"throw":!0,attack:!0,use:!0,"default":"idle"},actorDirection:"down",actorAnims:{walkup:"walkup",walkright:"walkright",walkdown:"walkdown",walkleft:"walkleft",idleup:"idleup",idleright:"idleright",idledown:"idledown",idleleft:"idleleft",runup:"runup",runright:"runright",rundown:"rundown",runleft:"runleft"},actorInit:function(){},init:function(){}}),yespix.define("actor2w","actor",{actorMove:{idle:!0,right:!0,left:!0,lookup:!0,lookdown:!0,walk:!0,run:!0,jump:!0,longjump:!0,doublejump:!0,crouch:!0,guard:!0,damage:!0,dead:!0,"throw":!0,attack:!0,use:!0,"default":"idle"},actorSpeedJump:1.1,actorGravity:!0,actorDirection:"right",actorAnims:{idleright:"idleright",idleleft:"idleleft",walkright:"walkright",walkleft:"walkleft",lookup:"lookup",lookdown:"lookdown",lookup:"lookup",lookdown:"lookdown",attackleft:"attackleft",attackright:"attackright",jumpleft:"jumpleft",jumpright:"jumpright",airleft:"airleft",airright:"airright",landleft:"landleft",landright:"landright",left:"left",right:"right"},actorInit:function(){},init:function(){},move:function(){this.speedX+=this.accelX,this.speedY+=this.accelY,this.applyFriction(),this.applyGravity(),yespix.level&&yespix.level.collision(this),this.x+=this.speedX,this.y+=this.speedY},applyGravity:function(){return yespix.gravity?void(!this.isOnGround&&yespix.gravity&&(yespix.gravity.x&&(this.speedX+=yespix.gravity.x/20),yespix.gravity.y&&(this.speedY+=yespix.gravity.y/20))):!1},applyFriction:function(){return this.speedX*=1-this.moveFriction,this.speedY*=1-this.moveFriction,this.speedX<this.actorSpeedMin&&this.speedX>-this.actorSpeedMin&&(this.speedX=0),this.speedY<this.actorSpeedMin&&this.speedY>-this.actorSpeedMin&&(this.speedY=0),!0}}),yespix.define("base",{_yespix:yespix,_class:"",_ancestors:[],_scene:null,_id:1,_children:null,_parent:null,isActive:!0,isVisible:!1,isGlobal:!1,name:"",assets:function(){return[]},init:function(){return!0},ancestor:function(a){return yespix.inArray(this._ancestors,a)},"typeof":function(a){if(yespix.isArray(a)){for(var b=0;b<a.length;b++)if(this.typeOf(a[b]))return!0;return!1}return this.ancestor(a)||this._class==a},prop:function(a,b){if(yespix.isObject(a)){for(var c in a)this[c]=a[c];return this}return this[a]=b,this},clone:function(a){var b=yespix.clone(this);return b._id=yespix.entityNextId++,a&&b.prop(a),b._instances=null,yespix.dump(yespix.entityInstances),yespix.instanceAdd(b),yespix.dump(yespix.entityInstances),b},attach:function(a){return yespix.attach(this,a),this},detach:function(a){return yespix.detach(this,a),this},trigger:function(a,b){return yespix.trigger(a,b,this),this},on:function(a,b){return yespix.on(a,b,this),this},off:function(a,b){return yespix.off(a,b,this),this},listen:function(a,b){return yespix.listen(this,a,b)},destroy:function(){if(this._deleting=!0,this.isActive=!1,this.isVisible=!1,this._children)for(var a=0;a<this._children.length;a++)this._children[a]&&!this._children[a].deleting&&this._children[a].destroy();return yespix.instanceRemove(this),this}}),yespix.entityRootClassname="base",yespix.define("canvas",{canvasOptions:null,element:null,context:null,document:null,init:function(a){this.create(a)},create:function(a){a=a||{},a.document=a.document||yespix.document,a.width=a.width||800,a.height=a.height||600,a.style=a.style||{},a.id=a.id||"canvas"+this._id,a.class=a.class||"",a.autoAppend=a.autoAppend||!0,this.canvasOptions=a,this.document=a.document;var b=this.document.createElement("canvas");b.id=a.id,b.width=a.width,b.height=a.height,b.className=a.className;for(var c in a.style)b.style[c]=a.style[c];if(a.autoAppend){var d=this.document.getElementsByTagName("body")[0];d.appendChild(b)}this.use(b,a)},use:function(a,b){b=b||{},b.backgroundColor=b.backgroundColor||"#ffffff",b.clearOnEnterFrame=b.clearOnEnterFrame||!0,this.element=a,this.context=this.element.getContext("2d");var c=this;b.clearOnEnterFrame&&yespix.on("enterFrame",function(){c.clear()})},clear:function(){this.element&&(this.element.width=this.element.width)}}),yespix.define("scene",{sceneOptions:null,document:null,init:function(a){this.create(a)},create:function(a){a=a||{},a.document=a.document||yespix.document,this.sceneOptions=a}}),yespix.define("move",{speedX:0,speedY:0,accelX:0,accelY:0,moveFriction:.05,moveStop:function(){this.speedX=this.speedY=this.accelX=this.accelY=0},init:function(){yespix.on("enterFrame",this.move,this,yespix)},move:function(){this.applyGravity&&yespix.gravity&&this.applyGravity(),this.speedX+=this.accelX,this.speedY+=this.accelY,this.speedX*=1-this.moveFriction,this.speedY*=1-this.moveFriction,yespix.level&&yespix.level.collision(this),this.x+=this.speedX,this.y+=this.speedY},applyGravity:function(){}}),yespix.define("collision",{colOffsetX:0,colOffsetY:0,colType:"all",colClass:[],init:function(){yespix.isUndefined(this.colWidth)&&(this.colWidth=this.width),yespix.isUndefined(this.colHeight)&&(this.colHeight=this.height)},collisionWith:function(a){return 0==this.colClass.length?!0:a.typeof(this.colClass)?!0:!1},collisionBox:function(){return{x:this.x+this.colOffsetX*this.pixelSize,y:this.y+this.colOffsetY*this.pixelSize,width:this.colWidth*this.pixelSize,height:this.colHeight*this.pixelSize,offsetX:this.colOffsetX*this.pixelSize,offsetY:this.colOffsetY*this.pixelSize}},collision:function(){("all"==this.colType||"active"==this.colType)&&yespix.collision(this)},collisionOccupy:function(){"none"!=this.colType&&yespix.collisionOccupy(this)},over:function(a){return this.intersect(a)?this.z>a.z?!0:this.z==a.z&&this.globalZ>a.globalZ?!0:!1:!1},under:function(){return this.intersect(entity)?this.z<entity.z?!0:this.z==entity.z&&this.globalZ<entity.globalZ?!0:!1:!1},touch:function(a){return yespix.collisionTouch(this,a)},intersect:function(a){return yespix.collisionCheck(this,a)},inside:function(a){return yespix.collisionInside(this,a)}}),yespix.define("gfx",{_changed:!1,isReady:!1,isVisible:!0,snapToPixel:!1,x:0,y:0,z:0,zGlobal:0,alpha:1,rotation:0,_flipX:!1,_flipY:!1,asset:function(){return[]},init:function(){return yespix.listen(this,["z","zGlobal"],function(){yespix.drawEntitiesSort=!0}),!0},getDrawBox:function(){if(this.snapToPixel)var a=parseInt(this.x),b=parseInt(this.y);else var a=this.x,b=this.y;var c=this.width,d=this.height;if(this.typeof("image")){var e=this.image(this.imageSelected);c=this.width||e.width||e.realWidth,d=this.height||e.height||e.realHeight}else if(this.typeof("anim")){var e=this.image(this.imageSelected);c=this.width||e.width||e.realWidth,d=this.height||e.height||e.realHeight}return{x:a,y:b,width:c,height:d}},getContext:function(){if(this._context)return this._context;if(null==this._parent){var a=yespix.find(".canvas")[0];!this._context&&a&&(this._context=a.context)}return this._context}}),yespix.define("image","gfx",{isVisible:!0,images:[],imageSelected:0,imageDefaults:{isInitiated:!1,isReady:!1,src:"",element:null,document:yespix.document},init:function(){var a=1;this.pixelSize||(this.pixelSize=1),yespix.isString(this.images)&&(this.images=[{src:this.images}]);for(var b=0;b<this.images.length;b++){yespix.isString(this.images[b])&&(this.images[b]={src:this.images[b]});for(var c in this.imageDefaults)this.images[b][c]=this.images[b][c]||this.imageDefaults[c];""===this.images[b].name&&(this.images[b].name="image"+a++)}this.imageInit()},resize:function(a,b){var c=a.width*b,d=a.height*b,e=document.createElement("canvas");e.width=a.width,e.height=a.height;var f=e.getContext("2d");f.drawImage(a,0,0);var g=f.getImageData(0,0,a.width,a.height),h=document.createElement("canvas");h.width=c,h.height=d;for(var i=h.getContext("2d"),j=i.getImageData(0,0,c,d),k=0;d>k;k++)for(var l=0;c>l;l++){var m=4*(Math.floor(k/b)*a.width+Math.floor(l/b)),n=4*(k*c+l);j.data[n]=g.data[m],j.data[n+1]=g.data[m+1],j.data[n+2]=g.data[m+2],j.data[n+3]=g.data[m+3]}return i.putImageData(j,0,0),h},image:function(a){if(void 0==a)return this.images[0]?this.imageInit(this.images[0]):null;if("string"==typeof a)a={name:a};else if(yespix.isInt(a))return this.images[a]?this.imageInit(this.images[a]):null;for(var b=Object.keys(a).length,c=0,d=0;d<this.images.length;d++)for(var e in a)if(void 0!==this.images[d][e]&&a[e]==this.images[d][e]&&c++,c>=b)return this.imageInit(this.images[d]);return null},imageInit:function(a){var b=this;if(void 0==a){for(var c=0;c<this.images.length;c++)this.imageInit(this.images[c]);return!0}return a.isInitiated?a:(a.isReady=!1,a.isInitiated=!0,a.entity=b,a.element=document.createElement("img"),a.element&&(a.element.onload=a.element.onLoad=function(){a.realWidth=this.width,a.realHeight=this.height,a.isReady=!0,yespix.isUndefined(b.pixelSize)||1==b.pixelSize||(a.element=b.resize(a.element,b.pixelSize),a.realWidth=this.width*b.pixelSize,a.realHeight=this.height*b.pixelSize),b.trigger("imageReady",{target:a}),delete this.onload}),a.changeSource=function(a){return this.element.src=a,b.trigger("change"),!0},void 0!==a.src&&""!==a.src&&a.changeSource(a.src),a)},draw:function(a){if(this.isVisible){a||(this._context?a=this._context:(this.getContext(),this._context&&(a=this._context)));var b=this.image(this.imageSelected),c=this.getDrawBox(),d=this.flipX?-1:1,e=this.flipY?-1:1;if(a&&b&&b.element&&b.isReady&&(a.globalAlpha=this.alpha,a.drawImage(b.element,0,0,b.realWidth,b.realHeight,c.x,c.y,c.width,c.height),this.debug&&(a.globalAlpha=1,a.lineWidth=.5,a.strokeStyle="#ff1111",a.strokeRect(c.x-.5*d,c.y-.5*e,c.width+1*d,c.height+1*e),a.fillStyle="#999999",a.font="10px sans-serif",a.fillText("Image: "+this.imageSelected,c.x,c.y-5),this.collisionBox))){var c=this.collisionBox();a.lineWidth=.5,a.strokeStyle="#000099",a.strokeRect(c.x-.5*d,c.y-.5*e,c.width*this.pixelSize+1*d,c.height*this.pixelSize+1*e)}}}}),yespix.define("level","gfx",{data:{},isVisible:!0,isReady:!1,layers:[],canvas:null,context:null,block:function(a,b){var c=b*this.data.width+a,d=this.data.layers[0].data[c];return d>1?!0:!1},hit:function(){return!0},collisionRight:function(a,b,c,d){this.hit(c,d,"right",a.speedX),a.x=this.x+c*this.data.tilewidth-1e-4-b.offsetX-b.width,a.speedX=0},collisionLeft:function(a,b,c,d){this.hit(c,d,"left",a.speedX),a.x=this.x+(c+1)*this.data.tilewidth+1e-4-b.offsetX,a.speedX=0},collisionUp:function(a,b,c,d){this.hit(c,d,"up",a.speedY);var e=this.y+(d+1)*this.data.tileheight+1-b.offsetY;a.y=e,a.speedY=0},collisionDown:function(a,b,c,d){this.hit(c,d,"down",a.speedY),a.y=this.y+d*this.data.tileheight-b.offsetY-b.height-1,a.speedY=0,a.isOnGround=!0,a.isJumping=!1,a.isFalling=!1,this.accelY=0},collision:function(a){if(0!=a.speedX||0!=a.speedY){var b=!1,c=!1,d=!1,e=!1,f=a.collisionBox();if(a.speedX>0){var g=Math.floor((f.x+f.width)/this.data.tilewidth),h=Math.floor((f.x+f.width+a.speedX)/this.data.tilewidth);if(h>g){c=!0;for(var i=Math.floor(f.y/this.data.tileheight),j=Math.floor((f.y+f.height)/this.data.tileheight),k=!1,l=g;h>=l;l++){for(var m=i;j>=m;m++)if(this.block(l,m)){this.collisionRight(a,f,l,m),k=!0;break}if(k)break}}}else if(a.speedX<0){var n=Math.floor(f.x/this.data.tilewidth),h=Math.floor((f.x+a.speedX)/this.data.tilewidth);if(n>h){b=!0;for(var i=Math.floor(f.y/this.data.tileheight),j=Math.floor((f.y+f.height)/this.data.tileheight),k=!1,l=n;l>=h;l--){for(var m=i;j>=m;m++)if(this.block(l,m)){this.collisionLeft(a,f,l,m),k=!0;break}if(k)break}}}if(a.speedY>0){var j=Math.floor((f.y+f.height)/this.data.tileheight),h=Math.floor((f.y+f.height+a.speedY)/this.data.tileheight);if(h>j){e=!0;for(var n=Math.floor(f.x/this.data.tilewidth),g=Math.floor((f.x+f.width)/this.data.tilewidth),k=!1,m=j;h>=m;m++){for(var l=n;g>=l;l++)if(this.block(l,m)){this.collisionDown(a,f,l,m),k=!0;break}if(k)break}}}else if(a.speedY<0){var i=Math.floor(f.y/this.data.tileheight),h=Math.floor((f.y+a.speedY)/this.data.tileheight);if(i>h){d=!0;for(var n=Math.floor(f.x/this.data.tilewidth),g=Math.floor((f.x+f.width)/this.data.tilewidth),k=!1,m=i;m>=h;m--){for(var l=n;g>=l;l++)if(this.block(l,m)){this.collisionUp(a,f,l,m),k=!0;break}if(k)break}}}if(!d&&!c&&a.speedX>0&&a.speedY<0){var g=Math.floor((f.x+f.width+a.speedX)/this.data.tilewidth),i=Math.floor((f.y+a.speedY)/this.data.tileheight);this.block(g,i)&&(console.log("Double collision right top"),this.collisionUp(a,f,g,i),this.collisionRight(a,f,g,i))}else if(!e&&!c&&a.speedX>0&&a.speedY>0){var g=Math.floor((f.x+f.width+a.speedX)/this.data.tilewidth),j=Math.floor((f.y+f.height+a.speedY)/this.data.tileheight);this.block(g,j)&&(console.log("Double collision right down"),this.collisionDown(a,f,g,j),this.collisionRight(a,f,g,j))}else if(!e&&!b&&a.speedX<0&&a.speedY>0){var n=Math.floor((f.x+a.speedX)/this.data.tilewidth),j=Math.floor((f.y+f.height+a.speedY)/this.data.tileheight);this.block(n,j)&&(console.log("Double collision left down"),this.collisionDown(a,f,n,j),this.collisionLeft(a,f,n,j))}else if(!d&&!b&&a.speedX<0&&a.speedY<0){var n=Math.floor((f.x+a.speedX)/this.data.tilewidth),i=Math.floor((f.y+a.speedY)/this.data.tileheight);this.block(n,i)&&(console.log("Double collision left up"),this.collisionUp(a,f,n,i),this.collisionLeft(a,f,n,i))}if(0==a.speedY){var j=Math.floor((f.y+f.height)/this.data.tileheight),h=Math.floor((f.y+f.height+1)/this.data.tileheight);if(h==j)a.isOnGround=!1;else{a.isOnGround=!1;for(var n=Math.floor(f.x/this.data.tilewidth),g=Math.floor((f.x+f.width)/this.data.tilewidth),k=!1,m=j;h>=m;m++){for(var l=n;g>=l;l++)if(this.block(l,m)){a.isOnGround=!0,a.isJumping=!1,a.isFalling=!1,this.accelY=0,k=!0;break}if(k)break}}}else a.isOnGround=!1}},load:function(a){yespix.load(a,{complete:function(a){yespix.dump(a);var b=a.entity;b.data=JSON.parse(a.content),b.canvas=document.createElement("canvas"),b.context=b.canvas.getContext("2d");var c=0,d=["","","#ff9900","#FF0000","#006600","#000099"];b.canvas.width=b.data.width*b.data.tilewidth,b.canvas.height=b.data.height*b.data.tileheight;for(var e=0;e<b.data.height;e++)for(var f=0;f<b.data.width;f++){var g=b.data.layers[0].data[c];g>1&&(b.context.fillStyle=d[g],b.context.fillRect(f*b.data.tilewidth,e*b.data.tileheight,b.data.tilewidth,b.data.tileheight)),c++}b.isReady=!0,yespix.level=b},entity:this})},draw:function(a){this.isVisible&&(a||(this._context?a=this._context:(this.getContext(),this._context&&(a=this._context))),a&&this.isReady&&(a.globalAlpha=this.alpha,a.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.canvas.width,this.canvas.height)))}}),yespix.define("rect","gfx",{lineWidth:0,lineColor:"#000000",rectColor:"#999999",isVisible:!0,init:function(){},draw:function(a){if(this.isVisible){a||(this._context?a=this._context:(this.getContext(),this._context&&(a=this._context)));var b=this.getDrawBox(),c=this.flipX?-1:1,d=this.flipY?-1:1;if(a&&(a.globalAlpha=this.alpha,this.lineWidth>0&&(a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor,a.strokeRect(b.x,b.y,b.width,b.height)),a.fillStyle=this.rectColor,a.fillRect(b.x,b.y,b.width,b.height),this.debug&&(a.globalAlpha=1,a.lineWidth=.5,a.strokeStyle="#ff1111",a.strokeRect(b.x-.5*c,b.y-.5*d,b.width+1*c,b.height+1*d),a.fillStyle="#999999",this.collisionBox))){var b=this.collisionBox();a.lineWidth=.5,a.strokeStyle="#000099",a.strokeRect(b.x-.5*c,b.y-.5*d,b.width*this.pixelSize+1*c,b.height*this.pixelSize+1*d)}}}}),yespix.define("sound",{sounds:[],soundDefaults:{isInitiated:!1,isSupported:!1,isReady:!1,volume:1,duration:0,formats:[],src:"",mimeType:"",loop:!1,autoplay:!1,element:null,document:yespix.document,assets:this.assets},init:function(){var a=1;yespix.isString(this.sounds)&&(this.sounds=[{src:this.sounds}]);for(var b=0;b<this.sounds.length;b++){for(var c in this.soundDefaults)this.sounds[b][c]=this.sounds[b][c]||this.soundDefaults[c];""===this.sounds[b].name&&(this.sounds[b].name="sound"+a++)}this.sound=function(a){var b="";if(void 0==a)return this.sounds[0]?this.soundInit(this.sounds[0]):null;if("string"==typeof a){if(a={name:a},-1!=a.name.indexOf("/")){var c=a.name.split("/");if(a.name=c[0],b=c[1],""==c[0])return this.soundInit(this.sounds[0])[b]()}}else if(Object.isInt(a))return this.sounds[a]?this.soundInit(this.sounds[a]):null;for(var d=Object.keys(a).length,e=0,f=0;f<this.sounds.length;f++)for(var g in a){if(void 0!==this.sounds[f][g]&&a[g]==this.sounds[f][g]&&e++,""!=b)return this.soundInit(this.sounds[f])[b]();if(e>=d)return this.soundInit(this.sounds[f])}return null},this.soundInit=function(a){if(parent=this,void 0==a){for(var b=0;b<this.sounds.length;b++)this.soundInit(this.sounds[b]);return!0}if(a.isInitiated)return a;if(a.isInitiated=!0,a.element=document.createElement("audio"),a.support=function(a){return void 0==a?!1:yespix.support(a)},a.changeSource=function(a){return this.support("."+yespix.getExtension(a))?(this.isSupported=!0,this.element.src=a,this.volume<0?this.volume=0:this.volume>1&&(this.volume=1),this.element.volume=this.volume,!0):!1},a.load=function(){return this.isSupported?(this.element.load(),this):this},a.play=function(){return this.isSupported?(this.element.play(),this):this},a.isPlaying=function(){return this.isSupported?!this.element.paused:null},a.pause=function(){return this.isSupported?(this.element.pause(),this):this},a.isPaused=function(){return this.isSupported?!!this.element.paused:null},a.mute=function(){return this.isSupported?(this.element.muted=!0,this):null},a.unmute=function(){return this.isSupported?(this.element.muted=!1,this):this},a.muteToggle=function(){return this.isSupported?(this.isMuted()?this.unmute():this.mute(),this):this},a.isMuted=function(){return this.isSupported?this.element.muted:null},a.restart=function(){return this.isSupported?(this.stop().play(),this):this},a.stop=function(){return this.isSupported?(this.element.pause(),this.setTime(0),this):this},a.setVolume=function(a){return this.isSupported?(this.volume=a,this.volume<0?this.volume=0:this.volume>1&&(this.volume=1),this.element.volume=this.volume,this):this},a.volumeUp=function(){return this.isSupported?(this.volume-=.1,this.volume<0?this.volume=0:this.volume>1&&(this.volume=1),this.element.volume=this.volume,this):this},a.volumeDown=function(){return this.isSupported?(this.volume+=.1,this.volume<0?this.volume=0:this.volume>1&&(this.volume=1),this.element.volume=this.volume,this):this},a.setTime=function(a){return this.isSupported?(this.element.currentTime=a,this):this},a.isEnded=function(){return this.isSupported?this.element.ended:null},void 0!==a.src&&""!==a.src)if(yespix.isArray(a.src))for(var b=0;b<a.src.length;b++)a.src[b]&&!a.isSupported&&a.changeSource(a.src[b]);else if(yespix.isArray(a.formats)&&a.formats.length>0)for(var b=0;b<a.formats.length;b++)a.formats[b]&&!a.isSupported&&a.changeSource(a.src+"."+a.formats[b]);else yespix.isString(a.src)&&""!=a.src&&a.changeSource(a.src);return a},this.assets=function(a){if(parent=this,void 0==a){for(var b=[],c=0;c<this.sounds.length;c++)b=b.concat(this.assets(this.sounds[c]));return b}if(void 0!==a.src&&""!==a.src){if(yespix.isArray(a.src)){for(var c=0;c<a.src.length;c++)if(a.src[c]&&yespix.support("."+yespix.getExtension(a.src[c])))return a.src=a.src[c],a.isSupported=!0,[a.src];return[]}if(yespix.isArray(a.formats)&&a.formats.length>0){for(var c=0;c<a.formats.length;c++)if(a.formats[c]&&yespix.support("."+a.formats[c]))return a.src=a.src+"."+a.formats[c],a.isSupported=!0,[a.src]}else{if(yespix.isString(a.src)&&-1!=a.src.indexOf("|")){for(var d=a.src.split("|"),c=0;c<d.length;c++)if(d[c]&&yespix.support("."+yespix.getExtension(d[c])))return a.src=d[c],a.isSupported=!0,[a.src];return[]}if(yespix.isString(a.src)&&""!=a.src&&yespix.support("."+yespix.getExtension(a.src)))return a.isSupported=!0,[a.src]}}return[]}}}),yespix.define("text","gfx",{textAlign:"left",textFont:"16px sans-serif",textColor:"#000000",text:"",draw:function(a){if(this.isVisible&&(a||(this._context?a=this._context:(this.getContext(),this._context&&(a=this._context))),a&&(a.globalAlpha=this.alpha,a.fillStyle=this.textColor,a.font=this.textFont,a.fillText(this.text,this.x,this.y),this.debug&&(a.globalAlpha=1,a.lineWidth=.5,a.strokeStyle="#ff1111",a.strokeRect(this.x-.5,this.x-.5,this.width,this.height),this.collisionBox)))){var b=this.collisionBox();a.lineWidth=.5,a.strokeStyle="#000099",a.strokeRect(b.x-.5*scaleX,b.y-.5*scaleY,b.width*this.pixelSize+1*scaleX,b.height*this.pixelSize+1*scaleY)}}});